2026-02-19 20:01:05 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateBMI\",\n        \"Description\": \"Calculate the patient's Body Mass Index (BMI) using weight and height.\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"weight_kg\",\n                \"input_desc\": \"Patient's weight in kilograms\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"height_m\",\n                \"input_desc\": \"Patient's height in meters\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"bmi\",\n                \"output_desc\": \"Patient's Body Mass Index (BMI)\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"BMI is calculated as weight divided by height squared.\",\n        \"Reasoning\": \"This step involves a mathematical formula to compute BMI, which fits the FormulaCalculation category.\"\n    },\n    {\n        \"Category\": \"ConditionEvaluation\",\n        \"Name\": \"DetermineWeightType\",\n        \"Description\": \"Determine which weight to use for Creatinine Clearance calculation based on BMI.\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"bmi\",\n                \"input_desc\": \"Patient's Body Mass Index (BMI)\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"weight_type\",\n                \"output_desc\": \"Type of weight to use: 'actual', 'ideal', or 'adjusted'\",\n                \"output_type\": \"string\"\n            }\n        ],\n        \"Detail\": \"If BMI < 18.5, use actual weight; if between 18.5 and 24.9, use ideal weight; if ≥ 25, use adjusted weight.\",\n        \"Reasoning\": \"This step uses a conditional logic to select the appropriate weight type, which fits the ConditionEvaluation category.\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapGenderCoefficient\",\n        \"Description\": \"Map the patient's gender to the corresponding gender coefficient for the Cockcroft-Gault Equation.\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"gender\",\n                \"input_desc\": \"Patient's gender ('male' or 'female')\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"gender_coefficient\",\n                \"output_desc\": \"Gender coefficient for the Cockcroft-Gault Equation (1 for male, 0.85 for female)\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"The gender coefficient is mapped based on the provided lookup table.\",\n        \"Reasoning\": \"This step maps a discrete value (gender) to another value (gender coefficient), which fits the DiscreteValueMapping category.\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateIdealBodyWeight\",\n        \"Description\": \"Calculate the patient's Ideal Body Weight (IBW) using the Devine formula.\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"height_inches\",\n                \"input_desc\": \"Patient's height in inches\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"gender\",\n                \"input_desc\": \"Patient's gender ('male' or 'female')\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"ibw_kg\",\n                \"output_desc\": \"Patient's Ideal Body Weight in kilograms\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"For males, IBW = 50 + 2.3 x (height in inches - 60); for females, IBW = 45.5 + 2.3 x (height in inches - 60).\",\n        \"Reasoning\": \"This step involves a mathematical formula to calculate IBW, which fits the FormulaCalculation category.\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateCreatinineClearance\",\n        \"Description\": \"Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation.\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"age\",\n                \"input_desc\": \"Patient's age in years\",\n                \"input_type\": \"int\"\n            },\n            {\n                \"input_name\": \"weight_kg\",\n                \"input_desc\": \"Patient's weight in kilograms\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"gender_coefficient\",\n                \"input_desc\": \"Gender coefficient for the Cockcroft-Gault Equation\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"serum_creatinine_mg_dL\",\n                \"input_desc\": \"Serum creatinine level in mg/dL\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"crcl_ml_min\",\n                \"output_desc\": \"Patient's Creatinine Clearance in mL/min\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"CrCl is calculated using the formula: ((140 - age) * weight * gender_coefficient) / (72 * serum_creatinine).\",\n        \"Reasoning\": \"This step involves a mathematical formula to compute CrCl, which fits the FormulaCalculation category.\"\n    }\n]",
    "flow_result": "(inputs(weight_kg, height_m, age, gender, serum_creatinine_mg_dL, height_inches) -> step1:CalculateBMI(weight_kg, height_m) -> step2:DetermineWeightType(bmi) -> step3:MapGenderCoefficient(gender) -> step4:CalculateIdealBodyWeight(height_inches, gender) -> step5:CalculateCreatinineClearance(age, weight_kg, gender_coefficient, serum_creatinine_mg_dL) -> outputs(crcl_ml_min)"
}
2026-02-19 20:01:36 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "Creatinine Clearance Calculation Using Cockcroft-Gault Equation",
        "description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation in mL/min.",
        "inputs": [
            {
                "input_name": "weight_kg",
                "input_desc": "Patient's weight in kilograms",
                "input_type": "float"
            },
            {
                "input_name": "height_m",
                "input_desc": "Patient's height in meters",
                "input_type": "float"
            },
            {
                "input_name": "age",
                "input_desc": "Patient's age in years",
                "input_type": "int"
            },
            {
                "input_name": "gender",
                "input_desc": "Patient's gender ('male' or 'female')",
                "input_type": "string"
            },
            {
                "input_name": "serum_creatinine_mg_dL",
                "input_desc": "Serum creatinine level in mg/dL",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_bmi",
                "step_description": "Calculate the patient's Body Mass Index (BMI) using weight and height.",
                "step_inputs": [
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "height_m",
                        "input_desc": "Patient's height in meters",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "bmi",
                        "output_desc": "Patient's Body Mass Index (BMI)",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "BMI is calculated as weight divided by height squared."
            },
            {
                "step_id": "2",
                "step_name": "determine_weight_type",
                "step_description": "Determine which weight to use for Creatinine Clearance calculation based on BMI.",
                "step_inputs": [
                    {
                        "input_name": "bmi",
                        "input_desc": "Patient's Body Mass Index (BMI)",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "weight_type",
                        "output_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "output_type": "string"
                    }
                ],
                "category": "ConditionEvaluation",
                "detail": "If BMI < 18.5, use actual weight; if between 18.5 and 24.9, use ideal weight; if ≥ 25, use adjusted weight."
            },
            {
                "step_id": "3",
                "step_name": "map_gender_coefficient",
                "step_description": "Map the patient's gender to the corresponding gender coefficient for the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "gender_coefficient",
                        "output_desc": "Gender coefficient for the Cockcroft-Gault Equation (1 for male, 0.85 for female)",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "The gender coefficient is mapped based on the provided lookup table."
            },
            {
                "step_id": "4",
                "step_name": "calculate_ideal_body_weight",
                "step_description": "Calculate the patient's Ideal Body Weight (IBW) using the Devine formula.",
                "step_inputs": [
                    {
                        "input_name": "height_inches",
                        "input_desc": "Patient's height in inches",
                        "input_type": "float"
                    },
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "ibw_kg",
                        "output_desc": "Patient's Ideal Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "For males, IBW = 50 + 2.3 x (height in inches - 60); for females, IBW = 45.5 + 2.3 x (height in inches - 60)."
            },
            {
                "step_id": "5",
                "step_name": "calculate_adjusted_body_weight",
                "step_description": "Calculate the patient's Adjusted Body Weight (ABW) based on Ideal Body Weight (IBW) and Actual Body Weight (ABW).",
                "step_inputs": [
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "abw_kg",
                        "output_desc": "Patient's Adjusted Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Adjusted body weight is calculated as ABW = IBW + 0.4 x (actual body weight - IBW)."
            },
            {
                "step_id": "6",
                "step_name": "select_appropriate_weight",
                "step_description": "Select the appropriate weight based on the determined weight type.",
                "step_inputs": [
                    {
                        "input_name": "weight_type",
                        "input_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "input_type": "string"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "abw_kg",
                        "input_desc": "Patient's Adjusted Body Weight in kilograms",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "selected_weight_kg",
                        "output_desc": "Selected weight in kilograms based on the determined weight type",
                        "output_type": "float"
                    }
                ],
                "category": "ConditionalSelection",
                "detail": "If weight type is 'actual', selected weight is weight_kg. If it is 'ideal', selected weight is ibw_kg. If it is 'adjusted', selected weight is abw_kg."
            },
            {
                "step_id": "7",
                "step_name": "calculate_creatinine_clearance",
                "step_description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "age",
                        "input_desc": "Patient's age in years",
                        "input_type": "int"
                    },
                    {
                        "input_name": "selected_weight_kg",
                        "input_desc": "Selected weight in kilograms based on the determined weight type",
                        "input_type": "float"
                    },
                    {
                        "input_name": "gender_coefficient",
                        "input_desc": "Gender coefficient for the Cockcroft-Gault Equation",
                        "input_type": "float"
                    },
                    {
                        "input_name": "serum_creatinine_mg_dL",
                        "input_desc": "Serum creatinine level in mg/dL",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "crcl_ml_min",
                        "output_desc": "Patient's Creatinine Clearance in mL/min",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "CrCl is calculated using the formula: ((140 - age) * selected_weight_kg * gender_coefficient) / (72 * serum_creatinine_mg_dL)."
            }
        ],
        "output": {
            "output_name": "crcl_ml_min",
            "output_desc": "Patient's Creatinine Clearance in mL/min",
            "output_type": "float"
        }
    }
}
2026-02-19 20:02:15 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "Creatinine Clearance Calculation Using Cockcroft-Gault Equation",
        "description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation in mL/min.",
        "inputs": [
            {
                "input_name": "weight_kg",
                "input_desc": "Patient's weight in kilograms",
                "input_type": "float"
            },
            {
                "input_name": "height_m",
                "input_desc": "Patient's height in meters",
                "input_type": "float"
            },
            {
                "input_name": "age",
                "input_desc": "Patient's age in years",
                "input_type": "int"
            },
            {
                "input_name": "gender",
                "input_desc": "Patient's gender ('male' or 'female')",
                "input_type": "string"
            },
            {
                "input_name": "serum_creatinine_mg_dL",
                "input_desc": "Serum creatinine level in mg/dL",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_bmi",
                "step_description": "Calculate the patient's Body Mass Index (BMI) using weight and height.",
                "step_inputs": [
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    },
                    {
                        "input_name": "height_m",
                        "input_desc": "Patient's height in meters",
                        "input_type": "float",
                        "input_source": "$|inputs|.height_m"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "bmi",
                        "output_desc": "Patient's Body Mass Index (BMI)",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "BMI is calculated as weight divided by height squared."
            },
            {
                "step_id": "2",
                "step_name": "determine_weight_type",
                "step_description": "Determine which weight to use for Creatinine Clearance calculation based on BMI.",
                "step_inputs": [
                    {
                        "input_name": "bmi",
                        "input_desc": "Patient's Body Mass Index (BMI)",
                        "input_type": "float",
                        "input_source": "$|1|.bmi"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "weight_type",
                        "output_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "output_type": "string"
                    }
                ],
                "category": "ConditionEvaluation",
                "detail": "If BMI < 18.5, use actual weight; if between 18.5 and 24.9, use ideal weight; if ≥ 25, use adjusted weight."
            },
            {
                "step_id": "3",
                "step_name": "map_gender_coefficient",
                "step_description": "Map the patient's gender to the corresponding gender coefficient for the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string",
                        "input_source": "$|inputs|.gender"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "gender_coefficient",
                        "output_desc": "Gender coefficient for the Cockcroft-Gault Equation (1 for male, 0.85 for female)",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "The gender coefficient is mapped based on the provided lookup table."
            },
            {
                "step_id": "4",
                "step_name": "calculate_ideal_body_weight",
                "step_description": "Calculate the patient's Ideal Body Weight (IBW) using the Devine formula.",
                "step_inputs": [
                    {
                        "input_name": "height_inches",
                        "input_desc": "Patient's height in inches",
                        "input_type": "float",
                        "input_source": "$|1|.height_m_to_inches"
                    },
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string",
                        "input_source": "$|inputs|.gender"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "ibw_kg",
                        "output_desc": "Patient's Ideal Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "For males, IBW = 50 + 2.3 x (height in inches - 60); for females, IBW = 45.5 + 2.3 x (height in inches - 60)."
            },
            {
                "step_id": "5",
                "step_name": "calculate_adjusted_body_weight",
                "step_description": "Calculate the patient's Adjusted Body Weight (ABW) based on Ideal Body Weight (IBW) and Actual Body Weight (ABW).",
                "step_inputs": [
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|4|.ibw_kg"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "abw_kg",
                        "output_desc": "Patient's Adjusted Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Adjusted body weight is calculated as ABW = IBW + 0.4 x (actual body weight - IBW)."
            },
            {
                "step_id": "6",
                "step_name": "select_appropriate_weight",
                "step_description": "Select the appropriate weight based on the determined weight type.",
                "step_inputs": [
                    {
                        "input_name": "weight_type",
                        "input_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "input_type": "string",
                        "input_source": "$|2|.weight_type"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    },
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|4|.ibw_kg"
                    },
                    {
                        "input_name": "abw_kg",
                        "input_desc": "Patient's Adjusted Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|5|.abw_kg"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "selected_weight_kg",
                        "output_desc": "Selected weight in kilograms based on the determined weight type",
                        "output_type": "float"
                    }
                ],
                "category": "ConditionalSelection",
                "detail": "If weight type is 'actual', selected weight is weight_kg. If it is 'ideal', selected weight is ibw_kg. If it is 'adjusted', selected weight is abw_kg."
            },
            {
                "step_id": "7",
                "step_name": "calculate_creatinine_clearance",
                "step_description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "age",
                        "input_desc": "Patient's age in years",
                        "input_type": "int",
                        "input_source": "$|inputs|.age"
                    },
                    {
                        "input_name": "selected_weight_kg",
                        "input_desc": "Selected weight in kilograms based on the determined weight type",
                        "input_type": "float",
                        "input_source": "$|6|.selected_weight_kg"
                    },
                    {
                        "input_name": "gender_coefficient",
                        "input_desc": "Gender coefficient for the Cockcroft-Gault Equation",
                        "input_type": "float",
                        "input_source": "$|3|.gender_coefficient"
                    },
                    {
                        "input_name": "serum_creatinine_mg_dL",
                        "input_desc": "Serum creatinine level in mg/dL",
                        "input_type": "float",
                        "input_source": "$|inputs|.serum_creatinine_mg_dL"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "crcl_ml_min",
                        "output_desc": "Patient's Creatinine Clearance in mL/min",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "CrCl is calculated using the formula: ((140 - age) * selected_weight_kg * gender_coefficient) / (72 * serum_creatinine_mg_dL)."
            }
        ],
        "output": {
            "output_name": "crcl_ml_min",
            "output_desc": "Patient's Creatinine Clearance in mL/min",
            "output_type": "float",
            "output_source": "$|7|.crcl_ml_min"
        }
    }
}
2026-02-19 20:03:02 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "Creatinine Clearance Calculation Using Cockcroft-Gault Equation",
        "description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation in mL/min.",
        "inputs": [
            {
                "input_name": "weight_kg",
                "input_desc": "Patient's weight in kilograms",
                "input_type": "float"
            },
            {
                "input_name": "height_m",
                "input_desc": "Patient's height in meters",
                "input_type": "float"
            },
            {
                "input_name": "age",
                "input_desc": "Patient's age in years",
                "input_type": "int"
            },
            {
                "input_name": "gender",
                "input_desc": "Patient's gender ('male' or 'female')",
                "input_type": "string"
            },
            {
                "input_name": "serum_creatinine_mg_dL",
                "input_desc": "Serum creatinine level in mg/dL",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_bmi",
                "step_description": "Calculate the patient's Body Mass Index (BMI) using weight and height.",
                "step_inputs": [
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    },
                    {
                        "input_name": "height_m",
                        "input_desc": "Patient's height in meters",
                        "input_type": "float",
                        "input_source": "$|inputs|.height_m"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "bmi",
                        "output_desc": "Patient's Body Mass Index (BMI)",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "BMI is calculated as weight divided by height squared.",
                "code": "def calculate_bmi(weight_kg: float, height_m: float) -> float:\n    '''\n    decs: calculate the patient's body mass index (bmi) using weight and height\n    args:\n        - weight_kg (float): patient's weight in kilograms\n        - height_m (float): patient's height in meters\n    returns: bmi (float): patient's body mass index (bmi)\n    category: FormulaCalculation\n    '''\n    # calculate bmi using the formula: weight divided by height squared\n    bmi = weight_kg / (height_m ** 2)\n    return bmi"
            },
            {
                "step_id": "2",
                "step_name": "determine_weight_type",
                "step_description": "Determine which weight to use for Creatinine Clearance calculation based on BMI.",
                "step_inputs": [
                    {
                        "input_name": "bmi",
                        "input_desc": "Patient's Body Mass Index (BMI)",
                        "input_type": "float",
                        "input_source": "$|1|.bmi"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "weight_type",
                        "output_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "output_type": "string"
                    }
                ],
                "category": "ConditionEvaluation",
                "detail": "If BMI < 18.5, use actual weight; if between 18.5 and 24.9, use ideal weight; if ≥ 25, use adjusted weight.",
                "code": "def determine_weight_type(bmi: float) -> str:\n    '''\n    decs: Determine which weight to use for Creatinine Clearance calculation based on BMI.\n    args:\n        - bmi (float): Patient's Body Mass Index (BMI)\n    returns: weight_type (string): Type of weight to use: 'actual', 'ideal', or 'adjusted'\n    category: ConditionEvaluation\n    '''\n    if bmi < 18.5:\n        return 'actual'\n    elif 18.5 <= bmi <= 24.9:\n        return 'ideal'\n    else:\n        return 'adjusted'"
            },
            {
                "step_id": "3",
                "step_name": "map_gender_coefficient",
                "step_description": "Map the patient's gender to the corresponding gender coefficient for the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string",
                        "input_source": "$|inputs|.gender"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "gender_coefficient",
                        "output_desc": "Gender coefficient for the Cockcroft-Gault Equation (1 for male, 0.85 for female)",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "The gender coefficient is mapped based on the provided lookup table.",
                "code": "def map_gender_coefficient(gender: str) -> float:\n    '''\n    decs:map the patient's gender to the corresponding gender coefficient for the Cockcroft-Gault Equation\n    args:\n        - gender (str): Patient's gender ('male' or 'female')\n    returns: gender_coefficient (float): Gender coefficient for the Cockcroft-Gault Equation (1 for male, 0.85 for female)\n    category: DiscreteValueMapping\n    '''\n    gender_mapping = {\n        'male': 1.0,\n        'female': 0.85\n    }\n    return gender_mapping.get(gender, 0.0)"
            },
            {
                "step_id": "4",
                "step_name": "calculate_ideal_body_weight",
                "step_description": "Calculate the patient's Ideal Body Weight (IBW) using the Devine formula.",
                "step_inputs": [
                    {
                        "input_name": "height_inches",
                        "input_desc": "Patient's height in inches",
                        "input_type": "float",
                        "input_source": "$|1|.height_m_to_inches"
                    },
                    {
                        "input_name": "gender",
                        "input_desc": "Patient's gender ('male' or 'female')",
                        "input_type": "string",
                        "input_source": "$|inputs|.gender"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "ibw_kg",
                        "output_desc": "Patient's Ideal Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "For males, IBW = 50 + 2.3 x (height in inches - 60); for females, IBW = 45.5 + 2.3 x (height in inches - 60).",
                "code": "def calculate_ideal_body_weight(height_inches: float, gender: str) -> float:\n    '''\n    decs: Calculate the patient's Ideal Body Weight (IBW) using the Devine formula.\n    args:\n        - height_inches (float): Patient's height in inches\n        - gender (str): Patient's gender ('male' or 'female')\n    returns: ibw_kg (float): Patient's Ideal Body Weight in kilograms\n    category: FormulaCalculation\n    '''\n    if gender == 'male':\n        ibw_kg = 50 + 2.3 * (height_inches - 60)\n    elif gender == 'female':\n        ibw_kg = 45.5 + 2.3 * (height_inches - 60)\n    else:\n        raise ValueError(\"Gender must be 'male' or 'female'\")\n    \n    return ibw_kg"
            },
            {
                "step_id": "5",
                "step_name": "calculate_adjusted_body_weight",
                "step_description": "Calculate the patient's Adjusted Body Weight (ABW) based on Ideal Body Weight (IBW) and Actual Body Weight (ABW).",
                "step_inputs": [
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|4|.ibw_kg"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "abw_kg",
                        "output_desc": "Patient's Adjusted Body Weight in kilograms",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Adjusted body weight is calculated as ABW = IBW + 0.4 x (actual body weight - IBW).",
                "code": "def calculate_adjusted_body_weight(ibw_kg: float, weight_kg: float) -> float:\n    '''\n    decs: calculate the patient's adjusted body weight based on ideal body weight and actual body weight\n    args:\n        - ibw_kg (float): Patient's Ideal Body Weight in kilograms\n        - weight_kg (float): Patient's weight in kilograms\n    returns: abw_kg (float): Patient's Adjusted Body Weight in kilograms\n    category: FormulaCalculation\n    '''\n    abw_kg = ibw_kg + 0.4 * (weight_kg - ibw_kg)\n    return abw_kg"
            },
            {
                "step_id": "6",
                "step_name": "select_appropriate_weight",
                "step_description": "Select the appropriate weight based on the determined weight type.",
                "step_inputs": [
                    {
                        "input_name": "weight_type",
                        "input_desc": "Type of weight to use: 'actual', 'ideal', or 'adjusted'",
                        "input_type": "string",
                        "input_source": "$|2|.weight_type"
                    },
                    {
                        "input_name": "weight_kg",
                        "input_desc": "Patient's weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|inputs|.weight_kg"
                    },
                    {
                        "input_name": "ibw_kg",
                        "input_desc": "Patient's Ideal Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|4|.ibw_kg"
                    },
                    {
                        "input_name": "abw_kg",
                        "input_desc": "Patient's Adjusted Body Weight in kilograms",
                        "input_type": "float",
                        "input_source": "$|5|.abw_kg"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "selected_weight_kg",
                        "output_desc": "Selected weight in kilograms based on the determined weight type",
                        "output_type": "float"
                    }
                ],
                "category": "ConditionalSelection",
                "detail": "If weight type is 'actual', selected weight is weight_kg. If it is 'ideal', selected weight is ibw_kg. If it is 'adjusted', selected weight is abw_kg.",
                "code": "def select_appropriate_weight(weight_type: str, weight_kg: float, ibw_kg: float, abw_kg: float) -> float:\n    '''\n    decs: Select the appropriate weight based on the determined weight type.\n    args:\n        - weight_type (str): Type of weight to use: 'actual', 'ideal', or 'adjusted'\n        - weight_kg (float): Patient's weight in kilograms\n        - ibw_kg (float): Patient's Ideal Body Weight in kilograms\n        - abw_kg (float): Patient's Adjusted Body Weight in kilograms\n    returns: selected_weight_kg (float): Selected weight in kilograms based on the determined weight type\n    category: ConditionalSelection\n    '''\n    if weight_type == 'actual':\n        return weight_kg\n    elif weight_type == 'ideal':\n        return ibw_kg\n    elif weight_type == 'adjusted':\n        return abw_kg\n    else:\n        raise ValueError(\"Invalid weight type provided. Must be 'actual', 'ideal', or 'adjusted'.\")"
            },
            {
                "step_id": "7",
                "step_name": "calculate_creatinine_clearance",
                "step_description": "Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation.",
                "step_inputs": [
                    {
                        "input_name": "age",
                        "input_desc": "Patient's age in years",
                        "input_type": "int",
                        "input_source": "$|inputs|.age"
                    },
                    {
                        "input_name": "selected_weight_kg",
                        "input_desc": "Selected weight in kilograms based on the determined weight type",
                        "input_type": "float",
                        "input_source": "$|6|.selected_weight_kg"
                    },
                    {
                        "input_name": "gender_coefficient",
                        "input_desc": "Gender coefficient for the Cockcroft-Gault Equation",
                        "input_type": "float",
                        "input_source": "$|3|.gender_coefficient"
                    },
                    {
                        "input_name": "serum_creatinine_mg_dL",
                        "input_desc": "Serum creatinine level in mg/dL",
                        "input_type": "float",
                        "input_source": "$|inputs|.serum_creatinine_mg_dL"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "crcl_ml_min",
                        "output_desc": "Patient's Creatinine Clearance in mL/min",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "CrCl is calculated using the formula: ((140 - age) * selected_weight_kg * gender_coefficient) / (72 * serum_creatinine_mg_dL).",
                "code": "def calculate_creatinine_clearance(age: int, selected_weight_kg: float, gender_coefficient: float, serum_creatinine_mg_dL: float) -> float:\n    '''\n    decs: Calculate the patient's Creatinine Clearance (CrCl) using the Cockcroft-Gault Equation\n    args:\n        - age (int): Patient's age in years\n        - selected_weight_kg (float): Selected weight in kilograms based on the determined weight type\n        - gender_coefficient (float): Gender coefficient for the Cockcroft-Gault Equation\n        - serum_creatinine_mg_dL (float): Serum creatinine level in mg/dL\n    returns: crcl_ml_min (float): Patient's Creatinine Clearance in mL/min\n    category: FormulaCalculation\n    '''\n    crcl_ml_min = ((140 - age) * selected_weight_kg * gender_coefficient) / (72 * serum_creatinine_mg_dL)\n    return {\"crcl_ml_min\": crcl_ml_min}"
            }
        ],
        "output": {
            "output_name": "crcl_ml_min",
            "output_desc": "Patient's Creatinine Clearance in mL/min",
            "output_type": "float",
            "output_source": "$|7|.crcl_ml_min"
        }
    }
}
2026-02-20 14:11:04 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateMeanArterialPressure\",\n        \"Description\": \"使用公式计算平均动脉压（MAP）\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"systolic_blood_pressure\",\n                \"input_desc\": \"收缩压值（mm Hg）\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"diastolic_blood_pressure\",\n                \"input_desc\": \"舒张压值（mm Hg）\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"mean_arterial_pressure\",\n                \"output_desc\": \"平均动脉压（mm Hg）\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"应用公式：MAP = 1/3 * 收缩压 + 2/3 * 舒张压\",\n        \"Reasoning\": \"该步骤属于公式计算类别，因为需要根据给定的数学公式对两个输入参数进行运算，以得出最终结果。\"\n    }\n]",
    "flow_result": "(inputs(systolic_blood_pressure, diastolic_blood_pressure) -> step1:CalculateMeanArterialPressure(systolic_blood_pressure, diastolic_blood_pressure) -> outputs(mean_arterial_pressure)"
}
2026-02-20 14:11:11 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "float"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Use the provided formula to compute the mean arterial pressure.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "float"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Mean arterial pressure calculated in mm Hg",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Apply the formula: mean_arterial_pressure = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Mean arterial pressure calculated in mm Hg",
            "output_type": "float"
        }
    }
}
2026-02-20 14:11:23 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "float"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Use the provided formula to compute the mean arterial pressure.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "float",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "float",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Mean arterial pressure calculated in mm Hg",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Apply the formula: mean_arterial_pressure = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Mean arterial pressure calculated in mm Hg",
            "output_type": "float",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:11:30 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "float"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "float"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Use the provided formula to compute the mean arterial pressure.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "float",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "float",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Mean arterial pressure calculated in mm Hg",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Apply the formula: mean_arterial_pressure = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure.",
                "code": "def calculate_mean_arterial_pressure(systolic_blood_pressure: float, diastolic_blood_pressure: float) -> float:\n    '''\n    decs: calculate mean arterial pressure using the formula\n    args:\n        - systolic_blood_pressure (float): systolic blood pressure value in mm Hg\n        - diastolic_blood_pressure (float): diastolic blood pressure value in mm Hg\n    returns: mean_arterial_pressure (float): mean arterial pressure calculated in mm Hg\n    category: FormulaCalculation\n    '''\n    mean_arterial_pressure = (1 / 3) * systolic_blood_pressure + (2 / 3) * diastolic_blood_pressure\n    return mean_arterial_pressure"
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Mean arterial pressure calculated in mm Hg",
            "output_type": "float",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:11:55 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateMeanArterialPressure\",\n        \"Description\": \"计算平均动脉压（Mean Arterial Pressure, MAP）\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"systolic_blood_pressure\",\n                \"input_desc\": \"收缩压值（单位：mm Hg）\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"diastolic_blood_pressure\",\n                \"input_desc\": \"舒张压值（单位：mm Hg）\",\n                \"input_type\": \"number\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"mean_arterial_pressure\",\n                \"output_desc\": \"计算后的平均动脉压值（单位：mm Hg）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"使用公式 1/3 * (systolic blood pressure) + 2/3 * (diastolic blood pressure) 进行计算。\",\n        \"Reasoning\": \"该步骤涉及一个明确的数学公式，需要输入两个数值参数进行计算，因此归类为FormulaCalculation类别。\"\n    }\n]",
    "flow_result": "(inputs(systolic_blood_pressure, diastolic_blood_pressure) -> step1:CalculateMeanArterialPressure(systolic_blood_pressure, diastolic_blood_pressure) -> outputs(mean_arterial_pressure)"
}
2026-02-20 14:12:02 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the mean arterial pressure (MAP) in mm Hg using the formula 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the given formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "number"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "number"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Computed mean arterial pressure value in mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "The mean arterial pressure is calculated by applying the formula: 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Computed mean arterial pressure value in mm Hg",
            "output_type": "number"
        }
    }
}
2026-02-20 14:12:14 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the mean arterial pressure (MAP) in mm Hg using the formula 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the given formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Computed mean arterial pressure value in mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "The mean arterial pressure is calculated by applying the formula: 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Computed mean arterial pressure value in mm Hg",
            "output_type": "number",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:12:20 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the mean arterial pressure (MAP) in mm Hg using the formula 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value in mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value in mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the given formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value in mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value in mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Computed mean arterial pressure value in mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "The mean arterial pressure is calculated by applying the formula: 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
                "code": "def calculate_mean_arterial_pressure(systolic_blood_pressure: float, diastolic_blood_pressure: float) -> float:\n    '''\n    decs: calculate the mean arterial pressure using the given formula\n    args:\n        - systolic_blood_pressure (float): systolic blood pressure value in mm Hg\n        - diastolic_blood_pressure (float): diastolic blood pressure value in mm Hg\n    returns: mean_arterial_pressure (float): computed mean arterial pressure value in mm Hg\n    category: FormulaCalculation\n    '''\n    mean_arterial_pressure = (1 / 3) * systolic_blood_pressure + (2 / 3) * diastolic_blood_pressure\n    return mean_arterial_pressure"
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Computed mean arterial pressure value in mm Hg",
            "output_type": "number",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:15:19 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateMeanArterialPressure\",\n        \"Description\": \"根据公式计算平均动脉压（MAP）\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"systolic_blood_pressure\",\n                \"input_desc\": \"收缩压值，单位为mm Hg\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"diastolic_blood_pressure\",\n                \"input_desc\": \"舒张压值，单位为mm Hg\",\n                \"input_type\": \"number\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"mean_arterial_pressure\",\n                \"output_desc\": \"计算后的平均动脉压值，单位为mm Hg\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"使用公式 MAP = (1/3) * 收缩压 + (2/3) * 舒张压 计算平均动脉压。\",\n        \"Reasoning\": \"该步骤涉及特定数学公式的计算，符合FormulaCalculation工具模板的定义。\"\n    }\n]",
    "flow_result": "(inputs(systolic_blood_pressure, diastolic_blood_pressure) -> step1:CalculateMeanArterialPressure(systolic_blood_pressure, diastolic_blood_pressure) -> outputs(mean_arterial_pressure)"
}
2026-02-20 14:15:26 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the provided formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value, unit is mm Hg",
                        "input_type": "number"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                        "input_type": "number"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Use the formula: MAP = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure to compute the mean arterial pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
            "output_type": "number"
        }
    }
}
2026-02-20 14:15:38 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the provided formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value, unit is mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Use the formula: MAP = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure to compute the mean arterial pressure."
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
            "output_type": "number",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:15:45 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_mean_arterial_pressure",
        "description": "Calculate the patient's mean arterial pressure (MAP) in mm Hg using the formula: MAP = 1/3 * systolic blood pressure + 2/3 * diastolic blood pressure.",
        "inputs": [
            {
                "input_name": "systolic_blood_pressure",
                "input_desc": "Systolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            },
            {
                "input_name": "diastolic_blood_pressure",
                "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                "input_type": "number"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "calculate_mean_arterial_pressure",
                "step_description": "Calculate the mean arterial pressure using the provided formula.",
                "step_inputs": [
                    {
                        "input_name": "systolic_blood_pressure",
                        "input_desc": "Systolic blood pressure value, unit is mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.systolic_blood_pressure"
                    },
                    {
                        "input_name": "diastolic_blood_pressure",
                        "input_desc": "Diastolic blood pressure value, unit is mm Hg",
                        "input_type": "number",
                        "input_source": "$|inputs|.diastolic_blood_pressure"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "mean_arterial_pressure",
                        "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
                        "output_type": "number"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Use the formula: MAP = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure to compute the mean arterial pressure.",
                "code": "def calculate_mean_arterial_pressure(systolic_blood_pressure: float, diastolic_blood_pressure: float) -> float:\n    '''\n    decs: Calculate the mean arterial pressure using the provided formula.\n    args:\n        - systolic_blood_pressure (float): Systolic blood pressure value, unit is mm Hg\n        - diastolic_blood_pressure (float): Diastolic blood pressure value, unit is mm Hg\n    returns: mean_arterial_pressure (float): Calculated mean arterial pressure value, unit is mm Hg\n    category: FormulaCalculation\n    '''\n    mean_arterial_pressure = (1/3) * systolic_blood_pressure + (2/3) * diastolic_blood_pressure\n    return mean_arterial_pressure"
            }
        ],
        "output": {
            "output_name": "mean_arterial_pressure",
            "output_desc": "Calculated mean arterial pressure value, unit is mm Hg",
            "output_type": "number",
            "output_source": "$|1|.mean_arterial_pressure"
        }
    }
}
2026-02-20 14:22:30 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsToPoints\",\n        \"Description\": \"将临床症状是否为DVT映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否具有DVT的临床症状（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"clinical_signs_points\",\n                \"output_desc\": \"根据DVT症状对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出3.0；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEDiagnosisToPoints\",\n        \"Description\": \"将PE是否为首要诊断或同等可能映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"pe_diagnosis_points\",\n                \"output_desc\": \"根据PE诊断对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出3.0；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateToPoints\",\n        \"Description\": \"将心率是否>100映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_gt_100\",\n                \"input_desc\": \"心率是否大于100（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"heart_rate_points\",\n                \"output_desc\": \"根据心率对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出1.5；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationToPoints\",\n        \"Description\": \"将是否处于制动状态或手术后映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否处于制动状态或手术后（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"immobilization_points\",\n                \"output_desc\": \"根据制动状态或手术后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出1.5；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPETOPoints\",\n        \"Description\": \"将是否有既往PE或DVT病史映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往PE或DVT病史（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"previous_pe_points\",\n                \"output_desc\": \"根据既往PE或DVT病史对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出1.5；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysisToPoints\",\n        \"Description\": \"将是否有咯血映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"hemoptysis_points\",\n                \"output_desc\": \"根据咯血对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出1.0；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyToPoints\",\n        \"Description\": \"将是否有恶性肿瘤并接受治疗或姑息治疗映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy\",\n                \"input_desc\": \"是否有恶性肿瘤并接受治疗或姑息治疗（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"malignancy_points\",\n                \"output_desc\": \"根据恶性肿瘤情况对应的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则输出1.0；如果是'No'，则输出0.0。\",\n        \"Reasoning\": \"这是一个离散值映射问题，将'Yes'和'No'映射为具体的数值。\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateTotalScore\",\n        \"Description\": \"计算Wells评分总分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_points\",\n                \"input_desc\": \"临床症状DVT对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"pe_diagnosis_points\",\n                \"input_desc\": \"PE是否为首要诊断或同等可能对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"heart_rate_points\",\n                \"input_desc\": \"心率是否>100对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"immobilization_points\",\n                \"input_desc\": \"是否处于制动状态或手术后对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"previous_pe_points\",\n                \"input_desc\": \"是否有既往PE或DVT病史对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"hemoptysis_points\",\n                \"input_desc\": \"是否有咯血对应的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"malignancy_points\",\n                \"input_desc\": \"是否有恶性肿瘤并接受治疗或姑息治疗对应的分数\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_score\",\n                \"output_desc\": \"Wells评分总分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有条件得分相加得到总分。\",\n        \"Reasoning\": \"这是一个公式计算问题，需要对多个分数进行求和操作。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_diagnosis, heart_rate_gt_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy) -> step1:MapClinicalSignsToPoints(clinical_signs_dvt) -> step2:MapPEDiagnosisToPoints(pe_diagnosis) -> step3:MapHeartRateToPoints(heart_rate_gt_100) -> step4:MapImmobilizationToPoints(immobilization_or_surgery) -> step5:MapPreviousPETOPoints(previous_pe_or_dvt) -> step6:MapHemoptysisToPoints(hemoptysis) -> step7:MapMalignancyToPoints(malignancy) -> step8:CalculateTotalScore(clinical_signs_points, pe_diagnosis_points, heart_rate_points, immobilization_points, previous_pe_points, hemoptysis_points, malignancy_points) -> outputs(total_score))"
}
2026-02-20 14:23:06 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score",
        "description": "Calculate the patient's score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs of DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Whether heart rate is greater than 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient is immobilized or had surgery in the past 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether the patient has a history of PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of clinical signs of DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs of DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "clinical_signs_points",
                        "output_desc": "Points based on the presence of clinical signs of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 3.0; if 'No', output 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_diagnosis_to_points",
                "step_description": "Map whether PE is the top diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "pe_diagnosis_points",
                        "output_desc": "Points based on whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 3.0; if 'No', output 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate is greater than 100 to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Whether heart rate is greater than 100 (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "heart_rate_points",
                        "output_desc": "Points based on heart rate being greater than 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 1.5; if 'No', output 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether the patient is immobilized or had surgery in the past 4 weeks to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient is immobilized or had surgery in the past 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "immobilization_points",
                        "output_desc": "Points based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 1.5; if 'No', output 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_to_points",
                "step_description": "Map whether the patient has a history of PE or DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether the patient has a history of PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "previous_pe_points",
                        "output_desc": "Points based on previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 1.5; if 'No', output 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether the patient has hemoptysis to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "hemoptysis_points",
                        "output_desc": "Points based on the presence of hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 1.0; if 'No', output 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "malignancy_points",
                        "output_desc": "Points based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', output 1.0; if 'No', output 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_score",
                "step_description": "Sum all the points to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_points",
                        "input_desc": "Points based on clinical signs of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "pe_diagnosis_points",
                        "input_desc": "Points based on whether PE is the top diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "heart_rate_points",
                        "input_desc": "Points based on heart rate being greater than 100",
                        "input_type": "float"
                    },
                    {
                        "input_name": "immobilization_points",
                        "input_desc": "Points based on immobilization or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "previous_pe_points",
                        "input_desc": "Points based on previous PE or DVT history",
                        "input_type": "float"
                    },
                    {
                        "input_name": "hemoptysis_points",
                        "input_desc": "Points based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "malignancy_points",
                        "input_desc": "Points based on malignancy status",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score",
                        "output_desc": "Total Wells score calculated by summing all individual criteria scores",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Add all the individual scores together to get the final total score."
            }
        ],
        "output": {
            "output_name": "total_score",
            "output_desc": "Total Wells score calculated by summing all individual criteria scores",
            "output_type": "float"
        }
    }
}
2026-02-20 14:28:43 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsToPoints\",\n        \"Description\": \"将临床症状是否为DVT映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现DVT相关症状（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据DVT症状计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回3.0；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEAsDiagnosisToPoints\",\n        \"Description\": \"将PE是否为首要诊断映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_as_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_as_diagnosis\",\n                \"output_desc\": \"根据PE是否为首要诊断计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回3.0；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateToPoints\",\n        \"Description\": \"将心率是否超过100映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_over_100\",\n                \"input_desc\": \"心率是否超过100（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"根据心率计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.5；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationToPoints\",\n        \"Description\": \"将是否满足久坐或手术条件映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否满足久坐或手术条件（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization\",\n                \"output_desc\": \"根据久坐或手术条件计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.5；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVTToPoints\",\n        \"Description\": \"将是否有既往PE或DVT映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往PE或DVT（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_dvt\",\n                \"output_desc\": \"根据既往PE或DVT计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.5；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysisToPoints\",\n        \"Description\": \"将是否有咯血映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据咯血情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.0；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyToPoints\",\n        \"Description\": \"将是否存在恶性肿瘤映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy\",\n                \"input_desc\": \"是否存在恶性肿瘤（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"根据恶性肿瘤情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.0；如果为'No'，则返回0.0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为预设的分数。\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateTotalScore\",\n        \"Description\": \"计算Wells评分总分\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"根据DVT症状计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_as_diagnosis\",\n                \"input_desc\": \"根据PE是否为首要诊断计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"根据心率计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization\",\n                \"input_desc\": \"根据久坐或手术条件计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_dvt\",\n                \"input_desc\": \"根据既往PE或DVT计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"根据咯血情况计算的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"根据恶性肿瘤情况计算的得分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_score_wells\",\n                \"output_desc\": \"Wells评分总分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有子项得分相加得到最终总分。\",\n        \"Reasoning\": \"该步骤属于公式计算类别，因为它涉及多个数值的相加操作，用于得出最终结果。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_as_diagnosis, heart_rate_over_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy) -> step1:MapClinicalSignsToPoints(clinical_signs_dvt) -> step2:MapPEAsDiagnosisToPoints(pe_as_diagnosis) -> step3:MapHeartRateToPoints(heart_rate_over_100) -> step4:MapImmobilizationToPoints(immobilization_or_surgery) -> step5:MapPreviousPEOrDVTToPoints(previous_pe_or_dvt) -> step6:MapHemoptysisToPoints(hemoptysis) -> step7:MapMalignancyToPoints(malignancy) -> step8:CalculateTotalScore(score_clinical_signs_dvt, score_pe_as_diagnosis, score_heart_rate, score_immobilization, score_previous_pe_dvt, score_hemoptysis, score_malignancy) -> outputs(total_score_wells))"
}
2026-02-20 14:29:18 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT-related clinical signs to points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT-related clinical signs",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis to points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_as_diagnosis",
                        "output_desc": "Score based on whether PE is the primary diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate is over 100 to points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or surgery condition is met to points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or surgery condition",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT is present to points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy is present to points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT-related clinical signs",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_as_diagnosis",
                        "input_desc": "Score based on whether PE is the primary diagnosis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or surgery condition",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total Wells score",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Add all individual scores together to get the total score."
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 14:30:48 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT-related clinical signs to points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT-related clinical signs",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis to points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_as_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_as_diagnosis",
                        "output_desc": "Score based on whether PE is the primary diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate is over 100 to points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or surgery condition is met to points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or surgery condition",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT is present to points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy is present to points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT-related clinical signs",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_as_diagnosis",
                        "input_desc": "Score based on whether PE is the primary diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_as_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or surgery condition",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total Wells score",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Add all individual scores together to get the total score."
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells"
        }
    }
}
2026-02-20 14:31:34 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT-related clinical signs to points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT-related clinical signs",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0.",
                "code": "def map_clinical_signs_to_points(clinical_signs_dvt: str) -> float:\n    '''\n    decs:Map the presence of DVT-related clinical signs to points\n    args:\n        - clinical_signs_dvt (str): Whether clinical signs and symptoms of DVT are present (Yes/No)\n    returns: score_clinical_signs_dvt (float): Score based on DVT-related clinical signs\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis to points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_as_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_as_diagnosis",
                        "output_desc": "Score based on whether PE is the primary diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0.",
                "code": "def map_pe_as_diagnosis_to_points(pe_as_diagnosis: str) -> float:\n    '''\n    decs:map whether PE is the primary diagnosis to points\n    args:\n        - pe_as_diagnosis (str): Whether PE is the primary diagnosis (Yes/No)\n    returns: score_pe_as_diagnosis: Score based on whether PE is the primary diagnosis\n    category: DiscreteValueMapping\n    '''\n    if pe_as_diagnosis == 'Yes':\n        return 3.0\n    else:\n        return 0.0"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate is over 100 to points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0.",
                "code": "def map_heart_rate_to_points(heart_rate_over_100: str) -> float:\n    '''\n    decs:map whether heart rate is over 100 to points\n    args:\n        - heart_rate_over_100 (str): Whether heart rate is over 100 (Yes/No)\n    returns: score_heart_rate: Score based on heart rate\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_over_100 == 'Yes':\n        return 1.5\n    elif heart_rate_over_100 == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or surgery condition is met to points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or surgery condition",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0.",
                "code": "def map_immobilization_to_points(immobilization_or_surgery: str) -> float:\n    '''\n    decs: Map whether immobilization or surgery condition is met to points\n    args:\n        - immobilization_or_surgery (str): Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)\n    returns: score_immobilization (float): Score based on immobilization or surgery condition\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    elif immobilization_or_surgery == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT is present to points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0.",
                "code": "def map_previous_pe_or_dvt_to_points(previous_pe_or_dvt: str) -> float:\n    '''\n    decs:map whether previous PE or DVT is present to points\n    args:\n        - previous_pe_or_dvt (str): Whether there is a history of objectively diagnosed PE or DVT (Yes/No)\n    returns: score_previous_pe_dvt: Score based on previous PE or DVT\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt == 'Yes':\n        return 1.5\n    elif previous_pe_or_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0.",
                "code": "def map_hemoptysis_to_points(hemoptysis: str) -> float:\n    '''\n    decs: map whether hemoptysis is present to points\n    args:\n        - hemoptysis (str): Whether hemoptysis is present (Yes/No)\n    returns: score_hemoptysis (float): Score based on hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    else:\n        return 0.0"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy is present to points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0.",
                "code": "def map_malignancy_to_points(malignancy: str) -> float:\n    '''\n    decs: map whether malignancy is present to points\n    args:\n        - malignancy (str): Whether malignancy with treatment within 6 months or palliative (Yes/No)\n    returns: score_malignancy (float): Score based on malignancy\n    category: DiscreteValueMapping\n    '''\n    if malignancy == 'Yes':\n        return 1.0\n    elif malignancy == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT-related clinical signs",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_as_diagnosis",
                        "input_desc": "Score based on whether PE is the primary diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_as_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or surgery condition",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total Wells score",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Add all individual scores together to get the total score.",
                "code": "def calculate_total_score(score_clinical_signs_dvt: float, score_pe_as_diagnosis: float, score_heart_rate: float, score_immobilization: float, score_previous_pe_dvt: float, score_hemoptysis: float, score_malignancy: float) -> float:\n    '''\n    decs:sum all individual scores to calculate the total wells score\n    args:\n        - score_clinical_signs_dvt (float): score based on dvt-related clinical signs\n        - score_pe_as_diagnosis (float): score based on whether pe is the primary diagnosis\n        - score_heart_rate (float): score based on heart rate\n        - score_immobilization (float): score based on immobilization or surgery condition\n        - score_previous_pe_dvt (float): score based on previous pe or dvt\n        - score_hemoptysis (float): score based on hemoptysis\n        - score_malignancy (float): score based on malignancy\n    returns: total_score_wells (float): total wells score\n    category: formula calculation\n    '''\n    total_score_wells = (score_clinical_signs_dvt + \n                         score_pe_as_diagnosis + \n                         score_heart_rate + \n                         score_immobilization + \n                         score_previous_pe_dvt + \n                         score_hemoptysis + \n                         score_malignancy)\n    return total_score_wells"
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells"
        }
    }
}
2026-02-20 14:38:42 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsToPoints\",\n        \"Description\": \"将临床症状是否符合DVT的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现DVT的临床症状（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"clinical_signs_points\",\n                \"output_desc\": \"根据DVT症状判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回3分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEAsDiagnosisToPoints\",\n        \"Description\": \"将PE是否为首要诊断或同等可能的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_as_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"pe_diagnosis_points\",\n                \"output_desc\": \"根据PE作为诊断判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回3分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateToPoints\",\n        \"Description\": \"将心率是否超过100次/分钟的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate\",\n                \"input_desc\": \"患者心率（单位：次/分钟）\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"heart_rate_points\",\n                \"output_desc\": \"根据心率判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果心率>100，则返回1.5分；否则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散条件（心率>100）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationToPoints\",\n        \"Description\": \"将是否满足制动或手术史的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否满足制动至少3天或手术史（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"immobilization_points\",\n                \"output_desc\": \"根据制动或手术史判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.5分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVTToPoints\",\n        \"Description\": \"将是否有既往PE或DVT病史的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往PE或DVT病史（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"previous_pe_dvt_points\",\n                \"output_desc\": \"根据既往病史判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1.5分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysisToPoints\",\n        \"Description\": \"将是否有咯血的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"hemoptysis_points\",\n                \"output_desc\": \"根据咯血情况判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyToPoints\",\n        \"Description\": \"将是否存在恶性肿瘤并接受治疗或姑息治疗的标准映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy\",\n                \"input_desc\": \"是否存在恶性肿瘤并接受治疗或姑息治疗（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"malignancy_points\",\n                \"output_desc\": \"根据恶性肿瘤情况判断后的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回1分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤用于将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateTotalWellsScore\",\n        \"Description\": \"计算Wells评分总和。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_points\",\n                \"input_desc\": \"DVT症状对应分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"pe_diagnosis_points\",\n                \"input_desc\": \"PE是否为首要诊断或同等可能的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"heart_rate_points\",\n                \"input_desc\": \"心率是否>100的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"immobilization_points\",\n                \"input_desc\": \"制动或手术史的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"previous_pe_dvt_points\",\n                \"input_desc\": \"既往PE或DVT病史的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"hemoptysis_points\",\n                \"input_desc\": \"咯血情况的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"malignancy_points\",\n                \"input_desc\": \"恶性肿瘤情况的分数\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"wells_score\",\n                \"output_desc\": \"最终的Wells评分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有得分相加，得到总分。\",\n        \"Reasoning\": \"该步骤涉及多个变量的求和，属于公式计算，符合FormulaCalculation工具模板。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_as_diagnosis, heart_rate, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy) \n-> step1:MapClinicalSignsToPoints(clinical_signs_dvt) \n-> step2:MapPEAsDiagnosisToPoints(pe_as_diagnosis) \n-> step3:MapHeartRateToPoints(heart_rate) \n-> step4:MapImmobilizationToPoints(immobilization_or_surgery) \n-> step5:MapPreviousPEOrDVTToPoints(previous_pe_or_dvt) \n-> step6:MapHemoptysisToPoints(hemoptysis) \n-> step7:MapMalignancyToPoints(malignancy) \n-> step8:CalculateTotalWellsScore(clinical_signs_points, pe_diagnosis_points, heart_rate_points, immobilization_points, previous_pe_dvt_points, hemoptysis_points, malignancy_points) \n-> outputs(wells_score)"
}
2026-02-20 14:39:17 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT symptoms to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "clinical_signs_points",
                        "output_desc": "Points based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "pe_diagnosis_points",
                        "output_desc": "Points based on PE as diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate exceeds 100 bpm to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "heart_rate_points",
                        "output_desc": "Points based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If heart rate > 100, return 1.5; else return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or recent surgery occurred to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "immobilization_points",
                        "output_desc": "Points based on immobilization or surgery history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT history exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "previous_pe_dvt_points",
                        "output_desc": "Points based on previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "hemoptysis_points",
                        "output_desc": "Points based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy with treatment or palliative care exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "malignancy_points",
                        "output_desc": "Points based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_points",
                        "input_desc": "Points based on DVT symptoms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "pe_diagnosis_points",
                        "input_desc": "Points based on PE as diagnosis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "heart_rate_points",
                        "input_desc": "Points based on heart rate",
                        "input_type": "float"
                    },
                    {
                        "input_name": "immobilization_points",
                        "input_desc": "Points based on immobilization or surgery history",
                        "input_type": "float"
                    },
                    {
                        "input_name": "previous_pe_dvt_points",
                        "input_desc": "Points based on previous PE or DVT history",
                        "input_type": "float"
                    },
                    {
                        "input_name": "hemoptysis_points",
                        "input_desc": "Points based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "malignancy_points",
                        "input_desc": "Points based on malignancy status",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Sum all input scores to get the final Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 14:40:46 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT symptoms to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "clinical_signs_points",
                        "output_desc": "Points based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_as_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "pe_diagnosis_points",
                        "output_desc": "Points based on PE as diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate exceeds 100 bpm to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute",
                        "input_type": "float",
                        "input_source": "$|inputs|.heart_rate"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "heart_rate_points",
                        "output_desc": "Points based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If heart rate > 100, return 1.5; else return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or recent surgery occurred to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "immobilization_points",
                        "output_desc": "Points based on immobilization or surgery history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT history exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "previous_pe_dvt_points",
                        "output_desc": "Points based on previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "hemoptysis_points",
                        "output_desc": "Points based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy with treatment or palliative care exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "malignancy_points",
                        "output_desc": "Points based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_points",
                        "input_desc": "Points based on DVT symptoms",
                        "input_type": "float",
                        "input_source": "$|1|.clinical_signs_points"
                    },
                    {
                        "input_name": "pe_diagnosis_points",
                        "input_desc": "Points based on PE as diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.pe_diagnosis_points"
                    },
                    {
                        "input_name": "heart_rate_points",
                        "input_desc": "Points based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.heart_rate_points"
                    },
                    {
                        "input_name": "immobilization_points",
                        "input_desc": "Points based on immobilization or surgery history",
                        "input_type": "float",
                        "input_source": "$|4|.immobilization_points"
                    },
                    {
                        "input_name": "previous_pe_dvt_points",
                        "input_desc": "Points based on previous PE or DVT history",
                        "input_type": "float",
                        "input_source": "$|5|.previous_pe_dvt_points"
                    },
                    {
                        "input_name": "hemoptysis_points",
                        "input_desc": "Points based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.hemoptysis_points"
                    },
                    {
                        "input_name": "malignancy_points",
                        "input_desc": "Points based on malignancy status",
                        "input_type": "float",
                        "input_source": "$|7|.malignancy_points"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Sum all input scores to get the final Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 14:41:31 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_as_diagnosis",
                "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of DVT symptoms to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "clinical_signs_points",
                        "output_desc": "Points based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0.",
                "code": "def map_clinical_signs_to_points(clinical_signs_dvt: str) -> float:\n    '''\n    decs:map the presence of DVT symptoms to corresponding points\n    args:\n        - clinical_signs_dvt (str): Whether clinical signs of DVT are present (Yes/No)\n    returns: clinical_signs_points: Points based on DVT symptoms\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input value for clinical_signs_dvt. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_diagnosis_to_points",
                "step_description": "Map whether PE is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_as_diagnosis",
                        "input_desc": "Whether PE is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_as_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "pe_diagnosis_points",
                        "output_desc": "Points based on PE as diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 3.0; if 'No', return 0.0.",
                "code": "def map_pe_as_diagnosis_to_points(pe_as_diagnosis: str) -> float:\n    '''\n    decs: Maps whether PE is the primary diagnosis or equally likely to corresponding points.\n    args:\n        - pe_as_diagnosis (str): Whether PE is the primary diagnosis or equally likely (Yes/No)\n    returns: pe_diagnosis_points (float): Points based on PE as diagnosis\n    category: DiscreteValueMapping\n    '''\n    if pe_as_diagnosis == 'Yes':\n        return 3.0\n    elif pe_as_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether heart rate exceeds 100 bpm to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute",
                        "input_type": "float",
                        "input_source": "$|inputs|.heart_rate"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "heart_rate_points",
                        "output_desc": "Points based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If heart rate > 100, return 1.5; else return 0.0.",
                "code": "def map_heart_rate_to_points(heart_rate: float) -> float:\n    '''\n    decs: Map heart rate to corresponding points based on whether it exceeds 100 bpm\n    args:\n        - heart_rate (float): Patient's heart rate in beats per minute\n    returns: heart_rate_points (float): Points based on heart rate\n    category: DiscreteValueMapping\n    '''\n    if heart_rate > 100:\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_to_points",
                "step_description": "Map whether immobilization or recent surgery occurred to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "immobilization_points",
                        "output_desc": "Points based on immobilization or surgery history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0.",
                "code": "def map_immobilization_to_points(immobilization_or_surgery: str) -> float:\n    '''\n    decs: Map immobilization or recent surgery status to corresponding points\n    args:\n        - immobilization_or_surgery (str): Whether immobilization for at least 3 days or surgery within 4 weeks occurred (Yes/No)\n    returns: immobilization_points (float): Points based on immobilization or surgery history\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    elif immobilization_or_surgery == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_to_points",
                "step_description": "Map whether previous PE or DVT history exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "previous_pe_dvt_points",
                        "output_desc": "Points based on previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.5; if 'No', return 0.0.",
                "code": "def map_previous_pe_or_dvt_to_points(previous_pe_or_dvt: str) -> float:\n    '''\n    decs: Map whether previous PE or DVT history exists to corresponding points.\n    args:\n        - previous_pe_or_dvt (str): Whether there is a history of objectively diagnosed PE or DVT (Yes/No)\n    returns: previous_pe_dvt_points (float): Points based on previous PE or DVT history\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt == 'Yes':\n        return 1.5\n    elif previous_pe_or_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether hemoptysis is present to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "hemoptysis_points",
                        "output_desc": "Points based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0.",
                "code": "def map_hemoptysis_to_points(hemoptysis: str) -> float:\n    '''\n    decs: Map whether hemoptysis is present to corresponding points.\n    args:\n        - hemoptysis (str): Whether hemoptysis is present (Yes/No)\n    returns: hemoptysis_points (float): Points based on hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether malignancy with treatment or palliative care exists to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "malignancy_points",
                        "output_desc": "Points based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "detail": "If input is 'Yes', return 1.0; if 'No', return 0.0.",
                "code": "def map_malignancy_to_points(malignancy: str) -> float:\n    '''\n    decs:map malignancy status to corresponding points\n    args:\n        - malignancy (str): Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)\n    returns: malignancy_points (float): Points based on malignancy status\n    category: DiscreteValueMapping\n    '''\n    if malignancy == 'Yes':\n        return 1.0\n    else:\n        return 0.0"
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_points",
                        "input_desc": "Points based on DVT symptoms",
                        "input_type": "float",
                        "input_source": "$|1|.clinical_signs_points"
                    },
                    {
                        "input_name": "pe_diagnosis_points",
                        "input_desc": "Points based on PE as diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.pe_diagnosis_points"
                    },
                    {
                        "input_name": "heart_rate_points",
                        "input_desc": "Points based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.heart_rate_points"
                    },
                    {
                        "input_name": "immobilization_points",
                        "input_desc": "Points based on immobilization or surgery history",
                        "input_type": "float",
                        "input_source": "$|4|.immobilization_points"
                    },
                    {
                        "input_name": "previous_pe_dvt_points",
                        "input_desc": "Points based on previous PE or DVT history",
                        "input_type": "float",
                        "input_source": "$|5|.previous_pe_dvt_points"
                    },
                    {
                        "input_name": "hemoptysis_points",
                        "input_desc": "Points based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.hemoptysis_points"
                    },
                    {
                        "input_name": "malignancy_points",
                        "input_desc": "Points based on malignancy status",
                        "input_type": "float",
                        "input_source": "$|7|.malignancy_points"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "detail": "Sum all input scores to get the final Wells score.",
                "code": "def calculate_total_wells_score(clinical_signs_points: float, pe_diagnosis_points: float, heart_rate_points: float, immobilization_points: float, previous_pe_dvt_points: float, hemoptysis_points: float, malignancy_points: float) -> float:\n    '''\n    decs: calculate the total wells score by summing all individual scores\n    args:\n        - clinical_signs_points (float): Points based on DVT symptoms\n        - pe_diagnosis_points (float): Points based on PE as diagnosis\n        - heart_rate_points (float): Points based on heart rate\n        - immobilization_points (float): Points based on immobilization or surgery history\n        - previous_pe_dvt_points (float): Points based on previous PE or DVT history\n        - hemoptysis_points (float): Points based on hemoptysis\n        - malignancy_points (float): Points based on malignancy status\n    returns: wells_score (float): Total Wells score for pulmonary embolism\n    category: FormulaCalculation\n    '''\n    wells_score = clinical_signs_points + pe_diagnosis_points + heart_rate_points + immobilization_points + previous_pe_dvt_points + hemoptysis_points + malignancy_points\n    return wells_score"
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 17:04:33 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为深静脉血栓（DVT）映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现临床症状和体征提示DVT（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据DVT症状的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+3分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopDiagnosisOrEquallyLikely\",\n        \"Description\": \"将肺栓塞（PE）是否为首要诊断或同等可能映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_is_top_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"根据PE是否为首要诊断的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+3分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateOver100\",\n        \"Description\": \"将心率是否大于100次/分钟映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_over_100\",\n                \"input_desc\": \"心率是否大于100次/分钟（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"根据心率的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+1.5分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrRecentSurgery\",\n        \"Description\": \"将是否长期卧床或近期手术映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否长期卧床或近期手术（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization\",\n                \"output_desc\": \"根据长期卧床或近期手术的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+1.5分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVT\",\n        \"Description\": \"将是否有既往确诊的肺栓塞或深静脉血栓映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往确诊的肺栓塞或深静脉血栓（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe\",\n                \"output_desc\": \"根据既往确诊的肺栓塞或深静脉血栓的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+1.5分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据咯血的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+1分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否有恶性肿瘤并接受治疗或姑息治疗映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_with_treatment\",\n                \"input_desc\": \"是否有恶性肿瘤并接受治疗或姑息治疗（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"根据恶性肿瘤状态的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入是'Yes'，则返回+1分；如果是'No'，则返回0分。\",\n        \"Reasoning\": \"此步骤属于离散值映射类别，因为需要将'Yes'或'No'这样的离散值映射到预设的分数。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"SumAllScores\",\n        \"Description\": \"将所有条件的得分相加，得到最终的Wells评分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"临床症状和体征的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"心率的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization\",\n                \"input_desc\": \"长期卧床或近期手术的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe\",\n                \"input_desc\": \"既往确诊的肺栓塞或深静脉血栓的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"咯血的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"恶性肿瘤状态的得分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"wells_score\",\n                \"output_desc\": \"患者Wells评分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有条件的得分相加，得到总分。\",\n        \"Reasoning\": \"此步骤属于统计聚合类别，因为它对多个数值进行求和操作以计算最终结果。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_is_top_diagnosis, heart_rate_over_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy_with_treatment) -> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) -> step2:MapPEIsTopDiagnosisOrEquallyLikely(pe_is_top_diagnosis) -> step3:MapHeartRateOver100(heart_rate_over_100) -> step4:MapImmobilizationOrRecentSurgery(immobilization_or_surgery) -> step5:MapPreviousPEOrDVT(previous_pe_or_dvt) -> step6:MapHemoptysis(hemoptysis) -> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_with_treatment) -> step8:SumAllScores(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate, score_immobilization, score_previous_pe, score_hemoptysis, score_malignancy) -> outputs(wells_score))"
}
2026-02-20 17:05:15 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score of Wells' criteria for Pulmonary Embolism based on the provided clinical parameters.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a previous, objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all the scores to compute the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Patient's Wells score for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it sums multiple numerical values to derive the final result.",
                "detail": "Add up all the individual scores to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Patient's Wells score for Pulmonary Embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 17:06:59 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score of Wells' criteria for Pulmonary Embolism based on the provided clinical parameters.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a previous, objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all the scores to compute the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization"
                    },
                    {
                        "input_name": "score_previous_pe",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Patient's Wells score for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it sums multiple numerical values to derive the final result.",
                "detail": "Add up all the individual scores to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Patient's Wells score for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 17:07:46 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score of Wells' criteria for Pulmonary Embolism based on the provided clinical parameters.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:Map the presence of clinical signs and symptoms of DVT to the corresponding score.\n    args:\n        - clinical_signs_dvt (str): Whether clinical signs and symptoms of DVT are present (Yes/No)\n    returns: score_clinical_signs_dvt: Score based on DVT symptoms\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +3 points; if 'No', return 0 points.",
                "code": "def map_pe_is_top_diagnosis_or_equally_likely(pe_is_top_diagnosis: str) -> float:\n    '''\n    decs: Maps whether PE is the top diagnosis or equally likely to a corresponding score.\n    args:\n        - pe_is_top_diagnosis (str): Whether PE is the top diagnosis or equally likely (Yes/No)\n    returns: score_pe_top_diagnosis (float): Score based on whether PE is the top diagnosis\n    category: DiscreteValueMapping\n    '''\n    if pe_is_top_diagnosis == 'Yes':\n        return 3.0\n    elif pe_is_top_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is greater than 100 beats per minute (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points.",
                "code": "def map_heart_rate_over_100(heart_rate_over_100: str) -> float:\n    '''\n    decs: Maps whether heart rate is greater than 100 beats per minute to the corresponding score\n    args:\n        - heart_rate_over_100 (str): Whether heart rate is greater than 100 beats per minute (Yes/No)\n    returns: score_heart_rate (float): Score based on heart rate\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_over_100 == 'Yes':\n        return 1.5\n    elif heart_rate_over_100 == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points.",
                "code": "def map_immobilization_or_recent_surgery(immobilization_or_surgery: str) -> float:\n    '''\n    decs: Map immobilization for at least 3 days or recent surgery to a corresponding score\n    args:\n        - immobilization_or_surgery (str): Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)\n    returns: score_immobilization (float): Score based on immobilization or recent surgery\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == \"Yes\":\n        return 1.5\n    elif immobilization_or_surgery == \"No\":\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a previous, objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe",
                        "output_desc": "Score based on previous PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1.5 points; if 'No', return 0 points.",
                "code": "def map_previous_pe_or_dvt(previous_pe_or_dvt: str) -> dict:\n    '''\n    decs:Map whether there is a previous, objectively diagnosed PE or DVT to the corresponding score.\n    args:\n        - previous_pe_or_dvt (str): Whether there is a previous, objectively diagnosed PE or DVT (Yes/No)\n    returns: score_previous_pe: Score based on previous PE or DVT\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt == 'Yes':\n        score = 1.5\n    else:\n        score = 0.0\n\n    return {'score_previous_pe': score}"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points.",
                "code": "def map_hemoptysis(hemoptysis: str) -> float:\n    '''\n    decs:map whether hemoptysis is present to the corresponding score\n    args:\n        - hemoptysis (str): Whether hemoptysis is present (Yes/No)\n    returns: score_hemoptysis (float): Score based on hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps 'Yes' or 'No' to a predefined score.",
                "detail": "If the input is 'Yes', return +1 point; if 'No', return 0 points.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_with_treatment: str) -> float:\n    '''\n    decs: Maps malignancy with treatment within 6 months or palliative to a score\n    args:\n        - malignancy_with_treatment (str): Whether malignancy with treatment within 6 months or palliative (Yes/No)\n    returns: score_malignancy (float): Score based on malignancy status\n    category: DiscreteValueMapping\n    '''\n    if malignancy_with_treatment == 'Yes':\n        return 1.0\n    elif malignancy_with_treatment == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all the scores to compute the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization"
                    },
                    {
                        "input_name": "score_previous_pe",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Patient's Wells score for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it sums multiple numerical values to derive the final result.",
                "detail": "Add up all the individual scores to obtain the total Wells score.",
                "code": "def sum_all_scores(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate: float, score_immobilization: float, score_previous_pe: float, score_hemoptysis: float, score_malignancy: float) -> dict:\n    '''\n    decs: Sum all the scores to compute the final Wells score for Pulmonary Embolism\n    args:\n        - score_clinical_signs_dvt (float): Score based on DVT symptoms\n        - score_pe_top_diagnosis (float): Score based on whether PE is the top diagnosis\n        - score_heart_rate (float): Score based on heart rate\n        - score_immobilization (float): Score based on immobilization or recent surgery\n        - score_previous_pe (float): Score based on previous PE or DVT\n        - score_hemoptysis (float): Score based on hemoptysis\n        - score_malignancy (float): Score based on malignancy status\n    returns: wells_score (float): Patient's Wells score for Pulmonary Embolism\n    category: StatisticalAggregation\n    '''\n    wells_score = (\n        score_clinical_signs_dvt +\n        score_pe_top_diagnosis +\n        score_heart_rate +\n        score_immobilization +\n        score_previous_pe +\n        score_hemoptysis +\n        score_malignancy\n    )\n    return {'wells_score': wells_score}"
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Patient's Wells score for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 17:49:13 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsToPoints\",\n        \"Description\": \"将临床症状（DVT）是否符合映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现深静脉血栓的临床症状（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs\",\n                \"output_desc\": \"根据临床症状得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +3 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEAsPrimaryDiagnosisToPoints\",\n        \"Description\": \"将肺栓塞作为首要诊断或同等可能的判断映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_primary_diagnosis\",\n                \"input_desc\": \"是否将肺栓塞作为首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_diagnosis\",\n                \"output_desc\": \"根据肺栓塞诊断判断得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +3 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateToPoints\",\n        \"Description\": \"将心率是否 > 100 映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate\",\n                \"input_desc\": \"患者的心率数值（单位：次/分钟）\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"根据心率判断得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果心率 > 100，则映射为 +1.5 分；否则为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元条件（>100 或 ≤100），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrSurgeryToPoints\",\n        \"Description\": \"将是否满足制动或手术条件映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否满足制动至少 3 天或近期手术（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization_surgery\",\n                \"output_desc\": \"根据制动或手术情况得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +1.5 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPESDVTToPoints\",\n        \"Description\": \"将是否有既往 PE 或 DVT 的病史映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_dvt\",\n                \"input_desc\": \"是否有既往客观诊断的 PE 或 DVT（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_dvt\",\n                \"output_desc\": \"根据既往病史得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +1.5 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysisToPoints\",\n        \"Description\": \"将是否有咯血映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据咯血情况得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +1 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyToPoints\",\n        \"Description\": \"将是否有恶性肿瘤映射为对应的分数\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy\",\n                \"input_desc\": \"是否有恶性肿瘤（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"根据恶性肿瘤情况得到的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值 'Yes' 映射为 +1 分，'No' 映射为 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是有限的选项（Yes/No），需要将其映射为对应的分数。\"\n    },\n    {\n        \"Category\": \"FormulaCalculation\",\n        \"Name\": \"CalculateTotalWellsScore\",\n        \"Description\": \"计算总分\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs\",\n                \"input_desc\": \"临床症状得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_diagnosis\",\n                \"input_desc\": \"肺栓塞诊断得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"心率得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization_surgery\",\n                \"input_desc\": \"制动或手术得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_dvt\",\n                \"input_desc\": \"既往病史得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"咯血得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"恶性肿瘤得分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_wells_score\",\n                \"output_desc\": \"Wells 评分总分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有子项得分相加，得到总分。\",\n        \"Reasoning\": \"该步骤属于公式计算类别，因为需要对多个变量进行求和操作以得到最终结果。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_primary_diagnosis, heart_rate, immobilization_or_surgery, previous_pe_dvt, hemoptysis, malignancy) \n-> step1:MapClinicalSignsToPoints(clinical_signs_dvt) \n-> step2:MapPEAsPrimaryDiagnosisToPoints(pe_primary_diagnosis) \n-> step3:MapHeartRateToPoints(heart_rate) \n-> step4:MapImmobilizationOrSurgeryToPoints(immobilization_or_surgery) \n-> step5:MapPreviousPESDVTToPoints(previous_pe_dvt) \n-> step6:MapHemoptysisToPoints(hemoptysis) \n-> step7:MapMalignancyToPoints(malignancy) \n-> step8:CalculateTotalWellsScore(score_clinical_signs, score_pe_diagnosis, score_heart_rate, score_immobilization_surgery, score_previous_pe_dvt, score_hemoptysis, score_malignancy) \n-> outputs(total_wells_score))"
}
2026-02-20 17:49:52 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_primary_diagnosis",
                "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of clinical signs of DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs",
                        "output_desc": "Score from clinical signs of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_primary_diagnosis_to_points",
                "step_description": "Map whether pulmonary embolism is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_primary_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_diagnosis",
                        "output_desc": "Score from PE as primary diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether the heart rate is greater than 100 to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score from heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary condition (>100 or not) to a specific score.",
                "detail": "If heart rate > 100, map to +1.5. Otherwise, map to 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_surgery_to_points",
                "step_description": "Map whether the patient meets immobilization or surgery conditions to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score from immobilization or surgery conditions",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_dvt_to_points",
                "step_description": "Map whether the patient has a history of PE or DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score from previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether the patient has hemoptysis to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score from hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether the patient has malignancy to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score from malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to get the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs",
                        "input_desc": "Score from clinical signs of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_diagnosis",
                        "input_desc": "Score from PE as primary diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score from heart rate > 100",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score from immobilization or surgery conditions",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score from previous PE or DVT history",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score from hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score from malignancy",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "reason": "This step belongs to FormulaCalculation because it sums multiple variables to produce a final result.",
                "detail": "Add all individual scores together to calculate the total Wells score."
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 17:51:42 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_primary_diagnosis",
                "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of clinical signs of DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs",
                        "output_desc": "Score from clinical signs of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_primary_diagnosis_to_points",
                "step_description": "Map whether pulmonary embolism is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_primary_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_primary_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_diagnosis",
                        "output_desc": "Score from PE as primary diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether the heart rate is greater than 100 to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                        "input_type": "float",
                        "input_source": "$|inputs|.heart_rate"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score from heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary condition (>100 or not) to a specific score.",
                "detail": "If heart rate > 100, map to +1.5. Otherwise, map to 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_surgery_to_points",
                "step_description": "Map whether the patient meets immobilization or surgery conditions to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score from immobilization or surgery conditions",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_dvt_to_points",
                "step_description": "Map whether the patient has a history of PE or DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score from previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether the patient has hemoptysis to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score from hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether the patient has malignancy to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score from malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to get the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs",
                        "input_desc": "Score from clinical signs of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs"
                    },
                    {
                        "input_name": "score_pe_diagnosis",
                        "input_desc": "Score from PE as primary diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score from heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score from immobilization or surgery conditions",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score from previous PE or DVT history",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score from hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score from malignancy",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "reason": "This step belongs to FormulaCalculation because it sums multiple variables to produce a final result.",
                "detail": "Add all individual scores together to calculate the total Wells score."
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.total_wells_score"
        }
    }
}
2026-02-20 17:52:32 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_primary_diagnosis",
                "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate",
                "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                "input_type": "float"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_to_points",
                "step_description": "Map the presence of clinical signs of DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs of deep vein thrombosis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs",
                        "output_desc": "Score from clinical signs of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0.",
                "code": "def map_clinical_signs_to_points(clinical_signs_dvt: str) -> float:\n    '''\n    decs:map the presence of clinical signs of DVT to corresponding points\n    args:\n        - clinical_signs_dvt (str): Whether the patient has clinical signs of deep vein thrombosis (Yes/No)\n    returns: score_clinical_signs: Score from clinical signs of DVT\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_as_primary_diagnosis_to_points",
                "step_description": "Map whether pulmonary embolism is the primary diagnosis or equally likely to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "pe_primary_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_primary_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_diagnosis",
                        "output_desc": "Score from PE as primary diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0.",
                "code": "def map_pe_primary_diagnosis_to_score(pe_primary_diagnosis: str) -> float:\n    '''\n    decs:map whether pulmonary embolism is the primary diagnosis or equally likely to corresponding points\n    args:\n        - pe_primary_diagnosis (str): Whether pulmonary embolism is the primary diagnosis or equally likely (Yes/No)\n    returns: score_pe_diagnosis: Score from PE as primary diagnosis or equally likely\n    category: DiscreteValueMapping\n    '''\n    if pe_primary_diagnosis == 'Yes':\n        return 3.0\n    elif pe_primary_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input value. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_to_points",
                "step_description": "Map whether the heart rate is greater than 100 to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate",
                        "input_desc": "Patient's heart rate in beats per minute (unit: bpm)",
                        "input_type": "float",
                        "input_source": "$|inputs|.heart_rate"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score from heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary condition (>100 or not) to a specific score.",
                "detail": "If heart rate > 100, map to +1.5. Otherwise, map to 0.",
                "code": "def map_heart_rate_to_points(heart_rate: float) -> float:\n    '''\n    decs: Map whether the heart rate is greater than 100 to corresponding points.\n    args:\n        - heart_rate (float): Patient's heart rate in beats per minute (unit: bpm)\n    returns: score_heart_rate (float): Score from heart rate > 100\n    category: DiscreteValueMapping\n    '''\n    if heart_rate > 100:\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_surgery_to_points",
                "step_description": "Map whether the patient meets immobilization or surgery conditions to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score from immobilization or surgery conditions",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0.",
                "code": "def map_immobilization_or_surgery_to_points(immobilization_or_surgery: str) -> float:\n    '''\n    decs: Map whether the patient meets immobilization or surgery conditions to corresponding points.\n    args:\n        - immobilization_or_surgery (str): Whether the patient has immobilization for at least 3 days or surgery within the last 4 weeks (Yes/No)\n    returns: score_immobilization_surgery: Score from immobilization or surgery conditions\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_dvt_to_points",
                "step_description": "Map whether the patient has a history of PE or DVT to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score from previous PE or DVT history",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0.",
                "code": "def map_previous_pe_dvt_to_points(previous_pe_dvt: str) -> dict:\n    '''\n    decs:map whether the patient has a history of PE or DVT to corresponding points\n    args:\n        - previous_pe_dvt (str): Whether the patient has a history of objectively diagnosed PE or DVT (Yes/No)\n    returns: score_previous_pe_dvt: Score from previous PE or DVT history\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_dvt == 'Yes':\n        score_previous_pe_dvt = 1.5\n    elif previous_pe_dvt == 'No':\n        score_previous_pe_dvt = 0\n    else:\n        raise ValueError(\"Invalid input value for previous_pe_dvt. Expected 'Yes' or 'No'.\")\n    \n    return {'score_previous_pe_dvt': score_previous_pe_dvt}"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis_to_points",
                "step_description": "Map whether the patient has hemoptysis to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score from hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0.",
                "code": "def map_hemoptysis_to_points(hemoptysis: str) -> float:\n    '''\n    decs: Maps whether the patient has hemoptysis to a corresponding score.\n    args:\n        - hemoptysis (str): Whether the patient has hemoptysis (Yes/No)\n    returns: score_hemoptysis (float): Score from hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_to_points",
                "step_description": "Map whether the patient has malignancy to corresponding points.",
                "step_inputs": [
                    {
                        "input_name": "malignancy",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score from malignancy",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to DiscreteValueMapping because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0.",
                "code": "def map_malignancy_to_points(malignancy: str) -> dict:\n    '''\n    decs:maps whether the patient has malignancy to corresponding points\n    args:\n        - malignancy (str): Whether the patient has malignancy with treatment within 6 months or palliative care (Yes/No)\n    returns: score_malignancy: Score from malignancy\n    category: DiscreteValueMapping\n    '''\n    if malignancy == \"Yes\":\n        score_malignancy = 1.0\n    else:\n        score_malignancy = 0.0\n\n    return {\"score_malignancy\": score_malignancy}"
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to get the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs",
                        "input_desc": "Score from clinical signs of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs"
                    },
                    {
                        "input_name": "score_pe_diagnosis",
                        "input_desc": "Score from PE as primary diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score from heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score from immobilization or surgery conditions",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score from previous PE or DVT history",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score from hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score from malignancy",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "FormulaCalculation",
                "reason": "This step belongs to FormulaCalculation because it sums multiple variables to produce a final result.",
                "detail": "Add all individual scores together to calculate the total Wells score.",
                "code": "def calculate_total_wells_score(score_clinical_signs: float, score_pe_diagnosis: float, score_heart_rate: float, score_immobilization_surgery: float, score_previous_pe_dvt: float, score_hemoptysis: float, score_malignancy: float) -> dict:\n    '''\n    decs: calculate the total wells score by summing all individual components\n    args:\n        - score_clinical_signs (float): Score from clinical signs of DVT\n        - score_pe_diagnosis (float): Score from PE as primary diagnosis or equally likely\n        - score_heart_rate (float): Score from heart rate > 100\n        - score_immobilization_surgery (float): Score from immobilization or surgery conditions\n        - score_previous_pe_dvt (float): Score from previous PE or DVT history\n        - score_hemoptysis (float): Score from hemoptysis\n        - score_malignancy (float): Score from malignancy\n    returns: total_wells_score: Total Wells score for pulmonary embolism\n    category: FormulaCalculation\n    '''\n    total_wells_score = (score_clinical_signs + score_pe_diagnosis + score_heart_rate + \n                         score_immobilization_surgery + score_previous_pe_dvt + \n                         score_hemoptysis + score_malignancy)\n    return {'total_wells_score': total_wells_score}"
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.total_wells_score"
        }
    }
}
2026-02-20 19:09:09 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"TimeSeriesProcessing\",\n        \"Name\": \"ConvertLastMenstrualPeriodToDateTime\",\n        \"Description\": \"将患者的最后月经日期字符串转换为可进行时间计算的格式。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"last_menstrual_period\",\n                \"input_desc\": \"患者最后一次月经的日期，格式为MM/DD/YYYY字符串。\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"converted_date\",\n                \"output_desc\": \"将输入的日期字符串转换为可进行时间运算的datetime对象。\",\n                \"output_type\": \"datetime\"\n            }\n        ],\n        \"Detail\": \"使用Python的datetime模块将输入的字符串日期转换为datetime对象，以便后续的时间计算。\",\n        \"Reasoning\": \"该步骤属于时间序列处理类别，因为需要将字符串日期转换为可以进行时间加减操作的格式。\"\n    },\n    {\n        \"Category\": \"TimeSeriesProcessing\",\n        \"Name\": \"AddTwoWeeksToDate\",\n        \"Description\": \"在患者的最后月经日期基础上增加两周，以估算受孕日期。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"converted_date\",\n                \"input_desc\": \"已转换为datetime对象的最后月经日期。\",\n                \"input_type\": \"datetime\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"estimated_conception_date\",\n                \"output_desc\": \"在最后月经日期上增加两周后的日期。\",\n                \"output_type\": \"datetime\"\n            }\n        ],\n        \"Detail\": \"使用datetime模块对日期进行加法操作，添加14天（两周）。\",\n        \"Reasoning\": \"该步骤属于时间序列处理类别，因为涉及对日期进行加减操作。\"\n    },\n    {\n        \"Category\": \"TimeSeriesProcessing\",\n        \"Name\": \"FormatEstimatedConceptionDate\",\n        \"Description\": \"将估算的受孕日期转换为指定的MM/DD/YYYY格式。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"estimated_conception_date\",\n                \"input_desc\": \"经过计算后得到的受孕日期，格式为datetime对象。\",\n                \"input_type\": \"datetime\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"formatted_estimated_conception_date\",\n                \"output_desc\": \"格式化后的受孕日期，符合MM/DD/YYYY格式。\",\n                \"output_type\": \"string\"\n            }\n        ],\n        \"Detail\": \"使用datetime对象的strftime方法，将其格式化为MM/DD/YYYY字符串。\",\n        \"Reasoning\": \"该步骤属于时间序列处理类别，因为需要对日期进行格式化处理。\"\n    }\n]",
    "flow_result": "(inputs(last_menstrual_period) -> step1:ConvertLastMenstrualPeriodToDateTime(last_menstrual_period) -> step2:AddTwoWeeksToDate(converted_date) -> step3:FormatEstimatedConceptionDate(estimated_conception_date) -> outputs(formatted_estimated_conception_date))"
}
2026-02-20 19:09:20 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "EstimatedDateOfConceptionCalculation",
        "description": "Calculate the estimated date of conception based on the patient's last menstrual period and cycle length.",
        "inputs": [
            {
                "input_name": "last_menstrual_period",
                "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "convert_last_menstrual_period_to_datetime",
                "step_description": "Convert the last menstrual period date string into a datetime object for further processing.",
                "step_inputs": [
                    {
                        "input_name": "last_menstrual_period",
                        "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "converted_date",
                        "output_desc": "The last menstrual period date converted into a datetime object.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves converting a string date into a datetime object for time-based calculations.",
                "detail": "Using Python's datetime module to parse the input string into a datetime object."
            },
            {
                "step_id": "2",
                "step_name": "add_two_weeks_to_date",
                "step_description": "Add 14 days (two weeks) to the last menstrual period date to estimate the conception date.",
                "step_inputs": [
                    {
                        "input_name": "converted_date",
                        "input_desc": "The last menstrual period date converted into a datetime object.",
                        "input_type": "datetime"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "estimated_conception_date",
                        "output_desc": "The estimated conception date after adding two weeks to the last menstrual period date.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves performing a time addition operation.",
                "detail": "Adding 14 days to the datetime object using the timedelta function from the datetime module."
            },
            {
                "step_id": "3",
                "step_name": "format_estimated_conception_date",
                "step_description": "Format the estimated conception date into MM/DD/YYYY format as required.",
                "step_inputs": [
                    {
                        "input_name": "estimated_conception_date",
                        "input_desc": "The estimated conception date as a datetime object.",
                        "input_type": "datetime"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "formatted_estimated_conception_date",
                        "output_desc": "The estimated conception date formatted in MM/DD/YYYY format.",
                        "output_type": "string"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves formatting a datetime object into a string.",
                "detail": "Using the strftime method of the datetime object to format the date as MM/DD/YYYY."
            }
        ],
        "output": {
            "output_name": "formatted_estimated_conception_date",
            "output_desc": "The final estimated conception date formatted in MM/DD/YYYY format.",
            "output_type": "string"
        }
    }
}
2026-02-20 19:09:51 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "EstimatedDateOfConceptionCalculation",
        "description": "Calculate the estimated date of conception based on the patient's last menstrual period and cycle length.",
        "inputs": [
            {
                "input_name": "last_menstrual_period",
                "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "convert_last_menstrual_period_to_datetime",
                "step_description": "Convert the last menstrual period date string into a datetime object for further processing.",
                "step_inputs": [
                    {
                        "input_name": "last_menstrual_period",
                        "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                        "input_type": "string",
                        "input_source": "$|inputs|.last_menstrual_period"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "converted_date",
                        "output_desc": "The last menstrual period date converted into a datetime object.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves converting a string date into a datetime object for time-based calculations.",
                "detail": "Using Python's datetime module to parse the input string into a datetime object."
            },
            {
                "step_id": "2",
                "step_name": "add_two_weeks_to_date",
                "step_description": "Add 14 days (two weeks) to the last menstrual period date to estimate the conception date.",
                "step_inputs": [
                    {
                        "input_name": "converted_date",
                        "input_desc": "The last menstrual period date converted into a datetime object.",
                        "input_type": "datetime",
                        "input_source": "$|1|.converted_date"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "estimated_conception_date",
                        "output_desc": "The estimated conception date after adding two weeks to the last menstrual period date.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves performing a time addition operation.",
                "detail": "Adding 14 days to the datetime object using the timedelta function from the datetime module."
            },
            {
                "step_id": "3",
                "step_name": "format_estimated_conception_date",
                "step_description": "Format the estimated conception date into MM/DD/YYYY format as required.",
                "step_inputs": [
                    {
                        "input_name": "estimated_conception_date",
                        "input_desc": "The estimated conception date as a datetime object.",
                        "input_type": "datetime",
                        "input_source": "$|2|.estimated_conception_date"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "formatted_estimated_conception_date",
                        "output_desc": "The estimated conception date formatted in MM/DD/YYYY format.",
                        "output_type": "string"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves formatting a datetime object into a string.",
                "detail": "Using the strftime method of the datetime object to format the date as MM/DD/YYYY."
            }
        ],
        "output": {
            "output_name": "formatted_estimated_conception_date",
            "output_desc": "The final estimated conception date formatted in MM/DD/YYYY format.",
            "output_type": "string",
            "output_source": "$|3|.formatted_estimated_conception_date"
        }
    }
}
2026-02-20 19:10:08 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "EstimatedDateOfConceptionCalculation",
        "description": "Calculate the estimated date of conception based on the patient's last menstrual period and cycle length.",
        "inputs": [
            {
                "input_name": "last_menstrual_period",
                "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "convert_last_menstrual_period_to_datetime",
                "step_description": "Convert the last menstrual period date string into a datetime object for further processing.",
                "step_inputs": [
                    {
                        "input_name": "last_menstrual_period",
                        "input_desc": "Patient's last menstrual period date in MM/DD/YYYY format.",
                        "input_type": "string",
                        "input_source": "$|inputs|.last_menstrual_period"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "converted_date",
                        "output_desc": "The last menstrual period date converted into a datetime object.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves converting a string date into a datetime object for time-based calculations.",
                "detail": "Using Python's datetime module to parse the input string into a datetime object.",
                "code": "def convert_last_menstrual_period_to_datetime(last_menstrual_period: str) -> dict:\n    '''\n    decs: Convert the last menstrual period date string into a datetime object\n    args:\n        - last_menstrual_period (str): Patient's last menstrual period date in MM/DD/YYYY format\n    returns: converted_date: The last menstrual period date converted into a datetime object\n    category: TimeSeriesProcessing\n    '''\n    import datetime\n    # Parse the input string into a datetime object using strptime\n    converted_date = datetime.datetime.strptime(last_menstrual_period, \"%m/%d/%Y\")\n    return {'converted_date': converted_date}"
            },
            {
                "step_id": "2",
                "step_name": "add_two_weeks_to_date",
                "step_description": "Add 14 days (two weeks) to the last menstrual period date to estimate the conception date.",
                "step_inputs": [
                    {
                        "input_name": "converted_date",
                        "input_desc": "The last menstrual period date converted into a datetime object.",
                        "input_type": "datetime",
                        "input_source": "$|1|.converted_date"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "estimated_conception_date",
                        "output_desc": "The estimated conception date after adding two weeks to the last menstrual period date.",
                        "output_type": "datetime"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves performing a time addition operation.",
                "detail": "Adding 14 days to the datetime object using the timedelta function from the datetime module.",
                "code": "def add_two_weeks_to_date(converted_date: datetime.datetime) -> datetime.datetime:\n    '''\n    decs: adds 14 days to the last menstrual period date to estimate the conception date\n    args:\n        - converted_date (datetime.datetime): The last menstrual period date converted into a datetime object\n    returns: estimated_conception_date: The estimated conception date after adding two weeks to the last menstrual period date\n    category: TimeSeriesProcessing\n    '''\n    # Create a timedelta object for 14 days\n    delta = datetime.timedelta(days=14)\n    # Add the delta to the input date to get the estimated conception date\n    estimated_conception_date = converted_date + delta\n    return estimated_conception_date"
            },
            {
                "step_id": "3",
                "step_name": "format_estimated_conception_date",
                "step_description": "Format the estimated conception date into MM/DD/YYYY format as required.",
                "step_inputs": [
                    {
                        "input_name": "estimated_conception_date",
                        "input_desc": "The estimated conception date as a datetime object.",
                        "input_type": "datetime",
                        "input_source": "$|2|.estimated_conception_date"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "formatted_estimated_conception_date",
                        "output_desc": "The estimated conception date formatted in MM/DD/YYYY format.",
                        "output_type": "string"
                    }
                ],
                "category": "TimeSeriesProcessing",
                "reason": "This step is categorized under TimeSeriesProcessing as it involves formatting a datetime object into a string.",
                "detail": "Using the strftime method of the datetime object to format the date as MM/DD/YYYY.",
                "code": "def format_estimated_conception_date(estimated_conception_date: datetime.datetime) -> dict:\n    '''\n    decs: format the estimated conception date into MM/DD/YYYY format\n    args:\n        - estimated_conception_date (datetime.datetime): The estimated conception date as a datetime object\n    returns: formatted_estimated_conception_date: The estimated conception date formatted in MM/DD/YYYY format\n    category: TimeSeriesProcessing\n    '''\n    formatted_date = estimated_conception_date.strftime(\"%m/%d/%Y\")\n    return {'formatted_estimated_conception_date': formatted_date}"
            }
        ],
        "output": {
            "output_name": "formatted_estimated_conception_date",
            "output_desc": "The final estimated conception date formatted in MM/DD/YYYY format.",
            "output_type": "string",
            "output_source": "$|3|.formatted_estimated_conception_date"
        }
    }
}
2026-02-20 19:44:29 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为DVT映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现临床症状和体征提示DVT（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"对应于临床症状和体征的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+3分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopriorityDiagnosis\",\n        \"Description\": \"将PE是否为首要诊断或同等可能映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_is_top_diagnosis\",\n                \"input_desc\": \"是否为PE的首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"对应于PE是否为首要诊断或同等可能的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+3分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateOver100\",\n        \"Description\": \"将心率是否超过100映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_over_100\",\n                \"input_desc\": \"是否心率>100（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"对应于心率是否超过100的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+1.5分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilityOrRecentSurgery\",\n        \"Description\": \"将是否长期卧床或近期手术映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobility_or_surgery\",\n                \"input_desc\": \"是否长期卧床或近期手术（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobility_surgery\",\n                \"output_desc\": \"对应于是否长期卧床或近期手术的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+1.5分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVT\",\n        \"Description\": \"将是否有既往PE或DVT病史映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_dvt\",\n                \"input_desc\": \"是否有既往PE或DVT病史（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_dvt\",\n                \"output_desc\": \"对应于是否患有既往PE或DVT的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+1.5分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"对应于咯血的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+1分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否存在恶性肿瘤且治疗中或姑息治疗映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_treatment_palliative\",\n                \"input_desc\": \"是否存在恶性肿瘤且治疗中或姑息治疗（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"对应于恶性肿瘤状态的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"根据输入值'Yes'或'No'，分别映射为+1分或0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为预设的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"SumScoresForWellsCriteria\",\n        \"Description\": \"对所有评分项进行求和，得到最终的Wells评分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"临床症状和体征的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"PE是否为首要诊断的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"心率是否超过100的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobility_surgery\",\n                \"input_desc\": \"是否长期卧床或近期手术的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_dvt\",\n                \"input_desc\": \"是否有既往PE或DVT病史的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"是否有咯血的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"是否存在恶性肿瘤且治疗中或姑息治疗的得分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"wells_score\",\n                \"output_desc\": \"最终的Wells评分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有评分项相加，得到总分。\",\n        \"Reasoning\": \"该步骤涉及对多个数值进行求和，符合StatisticalAggregation工具模板。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_is_top_diagnosis, heart_rate_over_100, immobility_or_surgery, previous_pe_dvt, hemoptysis, malignancy_treatment_palliative) -> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) -> step2:MapPEIsTopriorityDiagnosis(pe_is_top_diagnosis) -> step3:MapHeartRateOver100(heart_rate_over_100) -> step4:MapImmobilityOrRecentSurgery(immobility_or_surgery) -> step5:MapPreviousPEOrDVT(previous_pe_dvt) -> step6:MapHemoptysis(hemoptysis) -> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_treatment_palliative) -> step8:SumScoresForWellsCriteria(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate, score_immobility_surgery, score_previous_pe_dvt, score_hemoptysis, score_malignancy) -> outputs(wells_score)"
}
2026-02-20 19:45:12 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobility_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate > 100 to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate > 100 (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score corresponding to heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobility_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobility_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobility_surgery",
                        "output_desc": "Score corresponding to immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score corresponding to history of PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score corresponding to hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative care is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_scores_for_wells_criteria",
                "step_description": "Sum all the scores from the individual criteria to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score corresponding to heart rate > 100",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobility_surgery",
                        "input_desc": "Score corresponding to immobilization or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score corresponding to history of PE or DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score corresponding to hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score based on the sum of all criteria",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, fitting the StatisticalAggregation template.",
                "detail": "Add all the individual scores together to get the final Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score based on the sum of all criteria",
            "output_type": "float"
        }
    }
}
2026-02-20 19:46:53 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobility_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate > 100 to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate > 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score corresponding to heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobility_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobility_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobility_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobility_surgery",
                        "output_desc": "Score corresponding to immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score corresponding to history of PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score corresponding to hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative care is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_treatment_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_scores_for_wells_criteria",
                "step_description": "Sum all the scores from the individual criteria to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score corresponding to heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobility_surgery",
                        "input_desc": "Score corresponding to immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobility_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score corresponding to history of PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score corresponding to hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score based on the sum of all criteria",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, fitting the StatisticalAggregation template.",
                "detail": "Add all the individual scores together to get the final Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score based on the sum of all criteria",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 19:47:42 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobility_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:map the presence of clinical signs and symptoms of dvt to the corresponding score\n    args:\n        - clinical_signs_dvt (str): whether clinical signs and symptoms of dvt are present (yes/no)\n    returns: score_clinical_signs_dvt: score corresponding to clinical signs and symptoms of dvt\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt.lower() == 'yes':\n        return 3.0\n    elif clinical_signs_dvt.lower() == 'no':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +3. If 'No', map to 0.",
                "code": "def map_pe_is_top_diagnosis(pe_is_top_diagnosis: str) -> float:\n    '''\n    decs: Map whether PE is the top diagnosis or equally likely to the corresponding score.\n    args:\n        - pe_is_top_diagnosis (str): Whether PE is the top diagnosis or equally likely (Yes/No)\n    returns: score_pe_top_diagnosis: Score corresponding to whether PE is the top diagnosis or equally likely\n    category: DiscreteValueMapping\n    '''\n    if pe_is_top_diagnosis == 'Yes':\n        return 3.0\n    elif pe_is_top_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate > 100 to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate > 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score corresponding to heart rate > 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0.",
                "code": "def map_heart_rate_over_100(heart_rate_over_100: str) -> float:\n    '''\n    decs: Map whether heart rate > 100 to the corresponding score\n    args:\n        - heart_rate_over_100 (str): Whether heart rate > 100 (Yes/No)\n    returns: score_heart_rate: Score corresponding to heart rate > 100\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_over_100 == 'Yes':\n        return 1.5\n    elif heart_rate_over_100 == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "4",
                "step_name": "map_immobility_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobility_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobility_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobility_surgery",
                        "output_desc": "Score corresponding to immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0.",
                "code": "def map_immobility_or_surgery(immobility_or_surgery: str) -> float:\n    '''\n    decs: Map whether immobilization for at least 3 days or recent surgery to the corresponding score\n    args:\n        - immobility_or_surgery (str): Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)\n    returns: score_immobility_surgery (float): Score corresponding to immobilization or recent surgery\n    category: DiscreteValueMapping\n    '''\n    if immobility_or_surgery == 'Yes':\n        return 1.5\n    elif immobility_or_surgery == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score corresponding to history of PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1.5. If 'No', map to 0.",
                "code": "def map_previous_pe_or_dvt(previous_pe_dvt: str) -> float:\n    '''\n    decs:Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.\n    args:\n        - previous_pe_dvt (str): Whether there is a history of objectively diagnosed PE or DVT (Yes/No)\n    returns: score_previous_pe_dvt (float): Score corresponding to history of PE or DVT\n    category: DiscreteValueMapping\n    '''\n    mapping = {\n        'yes': 1.5,\n        'no': 0\n    }\n    return mapping.get(previous_pe_dvt.lower(), 0)"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score corresponding to hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0.",
                "code": "def map_hemoptysis(hemoptysis: str) -> dict:\n    '''\n    decs:map whether hemoptysis is present to the corresponding score\n    args:\n        - hemoptysis (str): Whether hemoptysis is present (Yes/No)\n    returns: score_hemoptysis: Score corresponding to hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        score = 1.0\n    elif hemoptysis == 'No':\n        score = 0.0\n    else:\n        raise ValueError(\"Invalid input for hemoptysis. Expected 'Yes' or 'No'.\")\n    \n    return {'score_hemoptysis': score}"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether malignancy with treatment within 6 months or palliative care is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_treatment_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to pre-defined scores, fitting the DiscreteValueMapping template.",
                "detail": "If 'Yes', map to +1. If 'No', map to 0.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_treatment_palliative: str) -> float:\n    '''\n    decs:map malignancy treatment or palliative care status to a corresponding score\n    args:\n        - malignancy_treatment_palliative (str): Whether malignancy with treatment within 6 months or palliative care (Yes/No)\n    returns: score_malignancy (float): Score corresponding to malignancy with treatment or palliative care\n    category: DiscreteValueMapping\n    '''\n    mapping = {\"Yes\": 1.0, \"No\": 0.0}\n    return mapping[malignancy_treatment_palliative]"
            },
            {
                "step_id": "8",
                "step_name": "sum_scores_for_wells_criteria",
                "step_description": "Sum all the scores from the individual criteria to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score corresponding to clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|2|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score corresponding to whether PE is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score corresponding to heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobility_surgery",
                        "input_desc": "Score corresponding to immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobility_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score corresponding to history of PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score corresponding to hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score corresponding to malignancy with treatment or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score based on the sum of all criteria",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, fitting the StatisticalAggregation template.",
                "detail": "Add all the individual scores together to get the final Wells score.",
                "code": "def sum_scores_for_wells_criteria(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate: float, score_immobility_surgery: float, score_previous_pe_dvt: float, score_hemoptysis: float, score_malignancy: float) -> float:\n    '''\n    decs: sum all the scores from the individual criteria to calculate the final wells score\n    args:\n        - score_clinical_signs_dvt (float): score corresponding to clinical signs and symptoms of DVT\n        - score_pe_top_diagnosis (float): score corresponding to whether PE is the top diagnosis or equally likely\n        - score_heart_rate (float): score corresponding to heart rate > 100\n        - score_immobility_surgery (float): score corresponding to immobilization or recent surgery\n        - score_previous_pe_dvt (float): score corresponding to history of PE or DVT\n        - score_hemoptysis (float): score corresponding to hemoptysis\n        - score_malignancy (float): score corresponding to malignancy with treatment or palliative care\n    returns: wells_score (float): final wells score based on the sum of all criteria\n    category: StatisticalAggregation\n    '''\n    wells_score = (\n        score_clinical_signs_dvt +\n        score_pe_top_diagnosis +\n        score_heart_rate +\n        score_immobility_surgery +\n        score_previous_pe_dvt +\n        score_hemoptysis +\n        score_malignancy\n    )\n    return wells_score"
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score based on the sum of all criteria",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 19:55:33 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为深静脉血栓（DVT）映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否出现深静脉血栓的临床症状和体征（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据DVT症状对应的分数（0或3）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 3；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（3或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopriorityDiagnosis\",\n        \"Description\": \"将肺栓塞是否为首要诊断或同等可能映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_is_top_diagnosis\",\n                \"input_desc\": \"肺栓塞是否为首要诊断或同等可能（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"根据首要诊断对应的分数（0或3）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 3；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（3或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateOver100\",\n        \"Description\": \"将心率是否超过100次/分钟映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_over_100\",\n                \"input_desc\": \"心率是否超过100次/分钟（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"根据心率对应的分数（0或1.5）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 1.5；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（1.5或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrRecentSurgery\",\n        \"Description\": \"将是否长期卧床或近期手术映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否长期卧床或近期手术（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization_surgery\",\n                \"output_desc\": \"根据卧床或手术对应的分数（0或1.5）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 1.5；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（1.5或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVT\",\n        \"Description\": \"将是否有既往肺栓塞或深静脉血栓病史映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往肺栓塞或深静脉血栓病史（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_dvt\",\n                \"output_desc\": \"根据既往病史对应的分数（0或1.5）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 1.5；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（1.5或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据咯血对应的分数（0或1）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 1；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（1或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否有恶性肿瘤且治疗中或姑息治疗映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_with_treatment\",\n                \"input_desc\": \"是否有恶性肿瘤且治疗中或姑息治疗（Yes/No）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"根据恶性肿瘤状态对应的分数（0或1）\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则输出 1；若输入为 'No'，则输出 0。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射到预设的分数（1或0），符合 DiscreteValueMapping 类别。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"CalculateTotalWellsScore\",\n        \"Description\": \"计算所有评分项的总分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"根据DVT症状对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"根据首要诊断对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"根据心率对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_immobilization_surgery\",\n                \"input_desc\": \"根据卧床或手术对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_dvt\",\n                \"input_desc\": \"根据既往病史对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"根据咯血对应的分数\",\n                \"input_type\": \"number\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"根据恶性肿瘤状态对应的分数\",\n                \"input_type\": \"number\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_wells_score\",\n                \"output_desc\": \"患者根据Wells标准计算出的总分\",\n                \"output_type\": \"number\"\n            }\n        ],\n        \"Detail\": \"对所有评分项进行求和操作，得到最终总分。\",\n        \"Reasoning\": \"该步骤涉及对多个数值进行求和，属于统计聚合类别。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_is_top_diagnosis, heart_rate_over_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy_with_treatment) \n-> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) \n-> step2:MapPEIsTopriorityDiagnosis(pe_is_top_diagnosis) \n-> step3:MapHeartRateOver100(heart_rate_over_100) \n-> step4:MapImmobilizationOrRecentSurgery(immobilization_or_surgery) \n-> step5:MapPreviousPEOrDVT(previous_pe_or_dvt) \n-> step6:MapHemoptysis(hemoptysis) \n-> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_with_treatment) \n-> step8:CalculateTotalWellsScore(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate, score_immobilization_surgery, score_previous_pe_dvt, score_hemoptysis, score_malignancy) \n-> outputs(total_wells_score)"
}
2026-02-20 19:56:17 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether clinical signs and symptoms of DVT are present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on the top diagnosis (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is over 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on immobilization or surgery (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether there is malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on top diagnosis",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on immobilization or surgery",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "number"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "number"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score calculated from all criteria",
                        "output_type": "number"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, which fits the StatisticalAggregation category.",
                "detail": "Add all the scores from the previous steps to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score calculated from all criteria",
            "output_type": "number"
        }
    }
}
2026-02-20 19:57:17 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether clinical signs and symptoms of DVT are present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on the top diagnosis (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is over 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on immobilization or surgery (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether there is malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "number",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on top diagnosis",
                        "input_type": "number",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "number",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on immobilization or surgery",
                        "input_type": "number",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "number",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "number",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "number",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score calculated from all criteria",
                        "output_type": "number"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, which fits the StatisticalAggregation category.",
                "detail": "Add all the scores from the previous steps to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score calculated from all criteria",
            "output_type": "number",
            "output_source": "$|8|.total_wells_score"
        }
    }
}
2026-02-20 19:58:05 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "calculate_wells_score_for_pulmonary_embolism",
        "description": "Calculate the patient's score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether hemoptysis is present (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether clinical signs and symptoms of DVT are present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether clinical signs and symptoms of DVT are present (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on DVT symptoms (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:maps whether clinical signs and symptoms of DVT are present to the corresponding score\n    args:\n        - clinical_signs_dvt (str): Whether clinical signs and symptoms of DVT are present (Yes/No)\n    returns: score_clinical_signs_dvt: Score based on DVT symptoms (0 or 3)\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether PE is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on the top diagnosis (0 or 3)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (3 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 3; if the input is 'No', output 0.",
                "code": "def map_pe_is_top_diagnosis(pe_is_top_diagnosis: str) -> float:\n    '''\n    decs:Map whether PE is the top diagnosis or equally likely to the corresponding score.\n    args:\n        - pe_is_top_diagnosis (str): Whether PE is the top diagnosis or equally likely (Yes/No)\n    returns: score_pe_top_diagnosis: Score based on the top diagnosis (0 or 3)\n    category: DiscreteValueMapping\n    '''\n    if pe_is_top_diagnosis == 'Yes':\n        return 3.0\n    else:\n        return 0.0"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_over_100",
                "step_description": "Map whether heart rate is over 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether heart rate is over 100 beats per minute (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on heart rate (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0.",
                "code": "def map_heart_rate_over_100(heart_rate_over_100: str = \"No\") -> float:\n    '''\n    decs: Maps whether heart rate is over 100 beats per minute to the corresponding score.\n    args:\n        - heart_rate_over_100 (str): Whether heart rate is over 100 beats per minute (Yes/No)\n    returns: score_heart_rate: Score based on heart rate (0 or 1.5)\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_over_100 == \"Yes\":\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on immobilization or surgery (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0.",
                "code": "def map_immobilization_or_recent_surgery(immobilization_or_surgery: str = \"No\") -> float:\n    '''\n    decs: Maps whether immobilization for at least 3 days or recent surgery to the corresponding score.\n    args:\n        - immobilization_or_surgery (str): Whether immobilization for at least 3 days or surgery in the previous 4 weeks (Yes/No)\n    returns: score_immobilization_surgery: Score based on immobilization or surgery (0 or 1.5)\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == \"Yes\":\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether there is a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether there is a history of objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on previous PE or DVT (0 or 1.5)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1.5 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1.5; if the input is 'No', output 0.",
                "code": "def map_previous_pe_or_dvt(previous_pe_or_dvt: str) -> float:\n    '''\n    decs:Maps whether there is a history of objectively diagnosed PE or DVT to the corresponding score.\n    args:\n        - previous_pe_or_dvt (str): Whether there is a history of objectively diagnosed PE or DVT (Yes/No)\n    returns: score_previous_pe_dvt: Score based on previous PE or DVT (0 or 1.5)\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt == 'Yes':\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether hemoptysis is present to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether hemoptysis is present (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0.",
                "code": "def map_hemoptysis(hemoptysis: str = \"No\") -> float:\n    '''\n    decs:map whether hemoptysis is present to the corresponding score\n    args:\n        - hemoptysis (str): Whether hemoptysis is present (Yes/No)\n    returns: score_hemoptysis: Score based on hemoptysis (0 or 1)\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == \"Yes\":\n        return 1.0\n    elif hemoptysis == \"No\":\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input for hemoptysis. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether there is malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on malignancy status (0 or 1)",
                        "output_type": "number"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step maps a discrete value (Yes/No) to a pre-defined score (1 or 0), which fits the DiscreteValueMapping category.",
                "detail": "If the input is 'Yes', output 1; if the input is 'No', output 0.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_with_treatment: str) -> float:\n    '''\n    decs: Maps whether there is malignancy with treatment within 6 months or palliative care to a corresponding score.\n    args:\n        - malignancy_with_treatment (str): Whether there is malignancy with treatment within 6 months or palliative care (Yes/No)\n    returns: score_malignancy: Score based on malignancy status (0 or 1)\n    category: DiscreteValueMapping\n    '''\n    if malignancy_with_treatment == 'Yes':\n        return 1.0\n    elif malignancy_with_treatment == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on DVT symptoms",
                        "input_type": "number",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on top diagnosis",
                        "input_type": "number",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on heart rate",
                        "input_type": "number",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on immobilization or surgery",
                        "input_type": "number",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on previous PE or DVT",
                        "input_type": "number",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "number",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on malignancy status",
                        "input_type": "number",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_wells_score",
                        "output_desc": "Total Wells score calculated from all criteria",
                        "output_type": "number"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves summing multiple numerical values, which fits the StatisticalAggregation category.",
                "detail": "Add all the scores from the previous steps to obtain the total Wells score.",
                "code": "def calculate_total_wells_score(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate: float, score_immobilization_surgery: float, score_previous_pe_dvt: float, score_hemoptysis: float, score_malignancy: float) -> float:\n    '''\n    decs: calculate the total wells score by summing all individual scores\n    args:\n        - score_clinical_signs_dvt (float): Score based on DVT symptoms\n        - score_pe_top_diagnosis (float): Score based on top diagnosis\n        - score_heart_rate (float): Score based on heart rate\n        - score_immobilization_surgery (float): Score based on immobilization or surgery\n        - score_previous_pe_dvt (float): Score based on previous PE or DVT\n        - score_hemoptysis (float): Score based on hemoptysis\n        - score_malignancy (float): Score based on malignancy status\n    returns: total_wells_score (float): Total Wells score calculated from all criteria\n    category: StatisticalAggregation\n    '''\n    total_wells_score = (score_clinical_signs_dvt + \n                         score_pe_top_diagnosis + \n                         score_heart_rate + \n                         score_immobilization_surgery + \n                         score_previous_pe_dvt + \n                         score_hemoptysis + \n                         score_malignancy)\n    return total_wells_score"
            }
        ],
        "output": {
            "output_name": "total_wells_score",
            "output_desc": "Total Wells score calculated from all criteria",
            "output_type": "number",
            "output_source": "$|8|.total_wells_score"
        }
    }
}
2026-02-20 20:02:44 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为DVT映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"患者是否有临床症状和体征表明DVT（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据DVT症状的有无计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+3；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopDiagnosisOrEquallyLikely\",\n        \"Description\": \"将PE是否为最可能诊断或同等可能映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_top_diagnosis\",\n                \"input_desc\": \"PE是否为最可能诊断或同等可能（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"根据PE是否为最可能诊断或同等可能计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+3；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateGreaterThan100\",\n        \"Description\": \"将心率是否大于100映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_gt_100\",\n                \"input_desc\": \"患者心率是否超过100（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate_gt_100\",\n                \"output_desc\": \"根据心率是否大于100计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrRecentSurgery\",\n        \"Description\": \"将是否因制动或近期手术而存在风险映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"患者是否存在制动至少3天或近4周内手术（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization_or_surgery\",\n                \"output_desc\": \"根据制动或近期手术情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVT\",\n        \"Description\": \"将是否有既往PE或DVT诊断映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"患者是否有既往PE或DVT诊断（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_or_dvt\",\n                \"output_desc\": \"根据既往PE或DVT诊断情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"患者是否有咯血（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据咯血情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否有恶性肿瘤且治疗在6个月内或姑息治疗映射为对应分值。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_with_treatment\",\n                \"input_desc\": \"患者是否有恶性肿瘤且治疗在6个月内或接受姑息治疗（是/否）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy_with_treatment\",\n                \"output_desc\": \"根据恶性肿瘤及治疗情况计算的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1；如果输入为'No'，则返回0。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为需要将输入的二元状态（Yes/No）映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"SumAllScores\",\n        \"Description\": \"将所有评分相加以得到最终Wells评分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"根据DVT症状的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"根据PE是否为最可能诊断的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate_gt_100\",\n                \"input_desc\": \"根据心率是否>100的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization_or_surgery\",\n                \"input_desc\": \"根据制动或近期手术的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_or_dvt\",\n                \"input_desc\": \"根据既往PE或DVT诊断的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"根据咯血情况的评分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy_with_treatment\",\n                \"input_desc\": \"根据恶性肿瘤及治疗情况的评分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"wells_score\",\n                \"output_desc\": \"患者的Wells评分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有评分相加，得到总Wells评分。\",\n        \"Reasoning\": \"该步骤属于统计聚合类别，因为它对多个数值进行求和操作。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_top_diagnosis, heart_rate_gt_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy_with_treatment) -> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) -> step2:MapPEIsTopDiagnosisOrEquallyLikely(pe_top_diagnosis) -> step3:MapHeartRateGreaterThan100(heart_rate_gt_100) -> step4:MapImmobilizationOrRecentSurgery(immobilization_or_surgery) -> step5:MapPreviousPEOrDVT(previous_pe_or_dvt) -> step6:MapHemoptysis(hemoptysis) -> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_with_treatment) -> step8:SumAllScores(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate_gt_100, score_immobilization_or_surgery, score_previous_pe_or_dvt, score_hemoptysis, score_malignancy_with_treatment) -> outputs(wells_score))"
}
2026-02-20 20:03:26 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on the presence of clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map heart rate > 100 to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Heart rate > 100 (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether heart rate is greater than 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map immobilization or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map previous PE or DVT diagnosis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on previous PE or DVT diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Hemoptysis (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment",
                        "output_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate > 100",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous PE or DVT diagnosis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment",
                        "input_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the StatisticalAggregation category because it aggregates multiple scores by summing them.",
                "detail": "Add all individual scores together to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score for pulmonary embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 20:04:27 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on the presence of clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map heart rate > 100 to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Heart rate > 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether heart rate is greater than 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map immobilization or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map previous PE or DVT diagnosis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on previous PE or DVT diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Hemoptysis (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment",
                        "output_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate_gt_100"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_or_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous PE or DVT diagnosis",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_or_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment",
                        "input_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the StatisticalAggregation category because it aggregates multiple scores by summing them.",
                "detail": "Add all individual scores together to obtain the total Wells score."
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 20:05:13 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_pulmonary_embolism_score",
        "description": "Calculate the patient’s score according to Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Heart rate > 100 (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Hemoptysis (Yes/No)",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment",
                "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Patient has clinical signs and symptoms of DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on the presence of clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:Map the presence of clinical signs and symptoms of DVT to its corresponding score.\n    args:\n        - clinical_signs_dvt (str): Patient has clinical signs and symptoms of DVT (Yes/No)\n    returns: score_clinical_signs_dvt (float): Score based on the presence of clinical signs and symptoms of DVT\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether PE is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "PE is the top diagnosis or equally likely (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +3; if 'No', return 0.",
                "code": "def map_pe_is_top_diagnosis_or_equally_likely(pe_top_diagnosis: str) -> float:\n    '''\n    decs:Map whether PE is the top diagnosis or equally likely to its corresponding score.\n    args:\n        - pe_top_diagnosis (str): PE is the top diagnosis or equally likely (Yes/No)\n    returns: score_pe_top_diagnosis: Score based on whether PE is the top diagnosis or equally likely\n    category: DiscreteValueMapping\n    '''\n    if pe_top_diagnosis == 'Yes':\n        return 3.0\n    elif pe_top_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map heart rate > 100 to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Heart rate > 100 (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether heart rate is greater than 100",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0.",
                "code": "def map_heart_rate_greater_than_100(heart_rate_gt_100: str = 'No') -> float:\n    '''\n    decs:map heart rate > 100 to its corresponding score\n    args:\n        - heart_rate_gt_100 (str): Heart rate > 100 (Yes/No)\n    returns: score_heart_rate_gt_100: Score based on whether heart rate is greater than 100\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_gt_100 == 'Yes':\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map immobilization or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0.",
                "code": "def map_immobilization_or_recent_surgery(immobilization_or_surgery: str) -> float:\n    '''\n    decs:map immobilization or recent surgery to its corresponding score\n    args:\n        - immobilization_or_surgery (str): immobilization at least 3 days or surgery in previous 4 weeks (Yes/No)\n    returns: score_immobilization_or_surgery: score based on immobilization or recent surgery\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map previous PE or DVT diagnosis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Previous objectively diagnosed PE or DVT (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on previous PE or DVT diagnosis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1.5; if 'No', return 0.",
                "code": "def map_previous_pe_or_dvt(previous_pe_or_dvt: str) -> float:\n    '''\n    decs:map previous pe or dvt diagnosis to its corresponding score\n    args:\n        - previous_pe_or_dvt (str): previous objectively diagnosed pe or dvt (yes/no)\n    returns: score_previous_pe_or_dvt: score based on previous pe or dvt diagnosis\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt.lower() == 'yes':\n        return 1.5\n    elif previous_pe_or_dvt.lower() == 'no':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Hemoptysis (Yes/No)",
                        "input_type": "string",
                        "input_source": null
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0.",
                "code": "def map_hemoptysis(hemoptysis: str) -> float:\n    '''\n    decs:map hemoptysis to its corresponding score\n    args:\n        - hemoptysis (str): Hemoptysis (Yes/No)\n    returns: score_hemoptysis: Score based on hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input for hemoptysis. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment",
                        "input_desc": "Malignancy with treatment within 6 months or palliative (Yes/No)",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment",
                        "output_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the DiscreteValueMapping category because it maps a binary state (Yes/No) to a corresponding score.",
                "detail": "If the input is 'Yes', return +1; if 'No', return 0.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_with_treatment: str) -> float:\n    '''\n    decs:map malignancy with treatment within 6 months or palliative to its corresponding score\n    args:\n        - malignancy_with_treatment (str): Malignancy with treatment within 6 months or palliative (Yes/No)\n    returns: score_malignancy_with_treatment: Score based on malignancy with treatment within 6 months or palliative care\n    category: DiscreteValueMapping\n    '''\n    if malignancy_with_treatment == 'Yes':\n        return 1.0\n    elif malignancy_with_treatment == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the final Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether PE is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate > 100",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate_gt_100"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_or_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous PE or DVT diagnosis",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_or_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment",
                        "input_desc": "Score based on malignancy with treatment within 6 months or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy_with_treatment"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "wells_score",
                        "output_desc": "Final Wells score for pulmonary embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the StatisticalAggregation category because it aggregates multiple scores by summing them.",
                "detail": "Add all individual scores together to obtain the total Wells score.",
                "code": "def sum_all_scores(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate_gt_100: float, score_immobilization_or_surgery: float, score_previous_pe_or_dvt: float, score_hemoptysis: float, score_malignancy_with_treatment: float) -> float:\n    '''\n    decs:sum all individual scores to calculate the final wells score\n    args:\n        - score_clinical_signs_dvt (float): score based on clinical signs and symptoms of DVT\n        - score_pe_top_diagnosis (float): score based on whether PE is the top diagnosis or equally likely\n        - score_heart_rate_gt_100 (float): score based on heart rate > 100\n        - score_immobilization_or_surgery (float): score based on immobilization or recent surgery\n        - score_previous_pe_or_dvt (float): score based on previous PE or DVT diagnosis\n        - score_hemoptysis (float): score based on hemoptysis\n        - score_malignancy_with_treatment (float): score based on malignancy with treatment within 6 months or palliative care\n    returns: wells_score (float): final wells score for pulmonary embolism\n    category: StatisticalAggregation\n    '''\n    wells_score = (\n        score_clinical_signs_dvt +\n        score_pe_top_diagnosis +\n        score_heart_rate_gt_100 +\n        score_immobilization_or_surgery +\n        score_previous_pe_or_dvt +\n        score_hemoptysis +\n        score_malignancy_with_treatment\n    )\n    return wells_score"
            }
        ],
        "output": {
            "output_name": "wells_score",
            "output_desc": "Final Wells score for pulmonary embolism",
            "output_type": "float",
            "output_source": "$|8|.wells_score"
        }
    }
}
2026-02-20 20:17:22 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为深静脉血栓（DVT）映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"是否具有临床症状和体征提示深静脉血栓（DVT）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据是否具有临床症状和体征提示深静脉血栓（DVT）计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +3 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopriorityDiagnosis\",\n        \"Description\": \"将肺栓塞是否为首要诊断或同等可能映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_is_top_diagnosis\",\n                \"input_desc\": \"肺栓塞是否为首要诊断或同等可能\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"根据是否为首要诊断或同等可能计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +3 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateGreaterThan100\",\n        \"Description\": \"将心率是否大于 100 次/分钟映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_gt_100\",\n                \"input_desc\": \"心率是否大于 100 次/分钟\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate_gt_100\",\n                \"output_desc\": \"根据心率是否大于 100 次/分钟计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +1.5 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrRecentSurgery\",\n        \"Description\": \"将是否有至少 3 天的制动或最近 4 周内的手术映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"是否有至少 3 天的制动或最近 4 周内的手术\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization_or_surgery\",\n                \"output_desc\": \"根据是否有制动或手术计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +1.5 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPEOrDVT\",\n        \"Description\": \"将是否有既往客观诊断的肺栓塞或深静脉血栓映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往客观诊断的肺栓塞或深静脉血栓\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_or_dvt\",\n                \"output_desc\": \"根据是否有既往诊断计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +1.5 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"是否有咯血\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据是否有咯血计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +1 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否有近 6 个月内接受治疗的恶性肿瘤或姑息治疗映射为对应分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_with_treatment_or_palliative\",\n                \"input_desc\": \"是否有近 6 个月内接受治疗的恶性肿瘤或姑息治疗\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy_with_treatment_or_palliative\",\n                \"output_desc\": \"根据是否有恶性肿瘤或姑息治疗计算的分数\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"若输入为 'Yes'，则返回 +1 分；若输入为 'No'，则返回 0 分。\",\n        \"Reasoning\": \"该步骤属于离散值映射类别，因为输入是二元选择（Yes/No），并映射到对应的分数。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"SumAllScores\",\n        \"Description\": \"将所有评分项相加，得到总分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"临床症状和体征提示 DVT 的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"肺栓塞是否为首要诊断或同等可能的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate_gt_100\",\n                \"input_desc\": \"心率是否大于 100 次/分钟的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization_or_surgery\",\n                \"input_desc\": \"是否有制动或手术的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_or_dvt\",\n                \"input_desc\": \"是否有既往诊断的肺栓塞或深静脉血栓的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"是否有咯血的分数\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy_with_treatment_or_palliative\",\n                \"input_desc\": \"是否有恶性肿瘤或姑息治疗的分数\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_score_wells_criteria\",\n                \"output_desc\": \"根据 Wells 标准计算的总分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有评分项的数值相加，得到总分。\",\n        \"Reasoning\": \"该步骤属于统计聚合类别，因为需要对多个数值进行求和操作。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_is_top_diagnosis, heart_rate_gt_100, immobilization_or_surgery, previous_pe_or_dvt, hemoptysis, malignancy_with_treatment_or_palliative) \n-> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) \n-> step2:MapPEIsTopriorityDiagnosis(pe_is_top_diagnosis) \n-> step3:MapHeartRateGreaterThan100(heart_rate_gt_100) \n-> step4:MapImmobilizationOrRecentSurgery(immobilization_or_surgery) \n-> step5:MapPreviousPEOrDVT(previous_pe_or_dvt) \n-> step6:MapHemoptysis(hemoptysis) \n-> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_with_treatment_or_palliative) \n-> step8:SumAllScores(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate_gt_100, score_immobilization_or_surgery, score_previous_pe_or_dvt, score_hemoptysis, score_malignancy_with_treatment_or_palliative) \n-> outputs(total_score_wells_criteria)"
}
2026-02-20 20:18:11 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment_or_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the heart rate is greater than 100 beats per minute to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether the heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on whether the patient has immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether the patient has a previous objectively diagnosed PE or DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on whether the patient has a previous objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment_or_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment_or_palliative",
                        "output_desc": "Score based on whether the patient has malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the total Wells' score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate greater than 100 beats per minute",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous objectively diagnosed PE or DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment_or_palliative",
                        "input_desc": "Score based on malignancy with treatment or palliative care",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells_criteria",
                        "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it aggregates multiple numerical inputs by summing them.",
                "detail": "Add all individual scores together to get the final total score."
            }
        ],
        "output": {
            "output_name": "total_score_wells_criteria",
            "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 20:18:49 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment_or_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the heart rate is greater than 100 beats per minute to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_gt_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether the heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on whether the patient has immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether the patient has a previous objectively diagnosed PE or DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on whether the patient has a previous objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment_or_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment_or_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment_or_palliative",
                        "output_desc": "Score based on whether the patient has malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0."
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the total Wells' score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate greater than 100 beats per minute",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate_gt_100"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_or_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous objectively diagnosed PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_or_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment_or_palliative",
                        "input_desc": "Score based on malignancy with treatment or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy_with_treatment_or_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells_criteria",
                        "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it aggregates multiple numerical inputs by summing them.",
                "detail": "Add all individual scores together to get the final total score."
            }
        ],
        "output": {
            "output_name": "total_score_wells_criteria",
            "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells_criteria"
        }
    }
}
2026-02-20 20:19:42 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score according to the Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_is_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_gt_100",
                "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_or_dvt",
                "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_with_treatment_or_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map the presence of clinical signs and symptoms of DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:map the presence of clinical signs and symptoms of DVT to its corresponding score\n    args:\n        - clinical_signs_dvt (str): Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)\n    returns: score_clinical_signs_dvt (float): Score based on whether the patient has clinical signs and symptoms of DVT\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        return 0.0"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_is_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_is_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +3. If the input is 'No', return 0.",
                "code": "def map_pe_is_top_diagnosis(pe_is_top_diagnosis: str) -> dict:\n    '''\n    decs: Map whether pulmonary embolism is the top diagnosis or equally likely to its corresponding score.\n    args:\n        - pe_is_top_diagnosis (str): Whether pulmonary embolism is the top diagnosis or equally likely. Possible values: 'Yes', 'No'.\n    returns: score_pe_top_diagnosis: Score based on whether pulmonary embolism is the top diagnosis or equally likely. Returns +3 if 'Yes', 0 if 'No'.\n    category: DiscreteValueMapping\n    '''\n    if pe_is_top_diagnosis == 'Yes':\n        score = 3.0\n    elif pe_is_top_diagnosis == 'No':\n        score = 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")\n    \n    return {'score_pe_top_diagnosis': score}"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the heart rate is greater than 100 beats per minute to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_gt_100",
                        "input_desc": "Whether the heart rate is greater than 100 beats per minute",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_gt_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate_gt_100",
                        "output_desc": "Score based on whether the heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0.",
                "code": "def map_heart_rate_greater_than_100(heart_rate_gt_100: str) -> dict:\n    '''\n    decs:Map whether the heart rate is greater than 100 beats per minute to its corresponding score.\n    args:\n        - heart_rate_gt_100 (str): Whether the heart rate is greater than 100 beats per minute ('Yes' or 'No')\n    returns: \n        - score_heart_rate_gt_100 (float): Score based on whether the heart rate is greater than 100 beats per minute\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_gt_100 == 'Yes':\n        score = 1.5\n    else:\n        score = 0.0\n\n    return {'score_heart_rate_gt_100': score}"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_or_surgery",
                        "output_desc": "Score based on whether the patient has immobilization or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0.",
                "code": "def map_immobilization_or_recent_surgery(immobilization_or_surgery: str) -> float:\n    '''\n    decs: Map whether the patient has immobilization for at least 3 days or recent surgery to its corresponding score.\n    args:\n        - immobilization_or_surgery (str): Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks\n    returns: score_immobilization_or_surgery: Score based on whether the patient has immobilization or recent surgery\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    else:\n        return 0.0"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt",
                "step_description": "Map whether the patient has a previous objectively diagnosed PE or DVT to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_or_dvt",
                        "input_desc": "Whether the patient has a previous objectively diagnosed PE or DVT",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_or_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_or_dvt",
                        "output_desc": "Score based on whether the patient has a previous objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1.5. If the input is 'No', return 0.",
                "code": "def map_previous_pe_or_dvt(previous_pe_or_dvt: str) -> float:\n    '''\n    decs:maps whether the patient has a previous objectively diagnosed PE or DVT to its corresponding score\n    args:\n        - previous_pe_or_dvt (str): Whether the patient has a previous objectively diagnosed PE or DVT\n    returns: score_previous_pe_or_dvt (float): Score based on whether the patient has a previous objectively diagnosed PE or DVT\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_or_dvt == 'Yes':\n        return 1.5\n    elif previous_pe_or_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0.",
                "code": "def map_hemoptysis(hemoptysis: str) -> float:\n    '''\n    decs:Map whether the patient has hemoptysis to its corresponding score.\n    args:\n        - hemoptysis (str): Whether the patient has hemoptysis (e.g., 'Yes' or 'No')\n    returns: score_hemoptysis: Score based on whether the patient has hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to its corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_with_treatment_or_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_with_treatment_or_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy_with_treatment_or_palliative",
                        "output_desc": "Score based on whether the patient has malignancy with treatment or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step belongs to the Discrete Value Mapping category because it maps a binary input (Yes/No) to a specific score.",
                "detail": "If the input is 'Yes', return +1. If the input is 'No', return 0.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_with_treatment_or_palliative: str) -> float:\n    '''\n    decs:Map whether the patient has malignancy with treatment within 6 months or palliative care to its corresponding score.\n    args:\n        - malignancy_with_treatment_or_palliative (str): Whether the patient has malignancy with treatment within 6 months or palliative care\n    returns: score_malignancy_with_treatment_or_palliative (float): Score based on whether the patient has malignancy with treatment or palliative care\n    category: DiscreteValueMapping\n    '''\n    if malignancy_with_treatment_or_palliative == 'Yes':\n        return {'score_malignancy_with_treatment_or_palliative': 1.0}\n    else:\n        return {'score_malignancy_with_treatment_or_palliative': 0.0}"
            },
            {
                "step_id": "8",
                "step_name": "sum_all_scores",
                "step_description": "Sum all individual scores to calculate the total Wells' score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate_gt_100",
                        "input_desc": "Score based on heart rate greater than 100 beats per minute",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate_gt_100"
                    },
                    {
                        "input_name": "score_immobilization_or_surgery",
                        "input_desc": "Score based on immobilization or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_or_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_or_dvt",
                        "input_desc": "Score based on previous objectively diagnosed PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_or_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy_with_treatment_or_palliative",
                        "input_desc": "Score based on malignancy with treatment or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy_with_treatment_or_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells_criteria",
                        "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step belongs to the Statistical Aggregation category because it aggregates multiple numerical inputs by summing them.",
                "detail": "Add all individual scores together to get the final total score.",
                "code": "def sum_all_scores(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate_gt_100: float, score_immobilization_or_surgery: float, score_previous_pe_or_dvt: float, score_hemoptysis: float, score_malignancy_with_treatment_or_palliative: float) -> float:\n    '''\n    decs: Sum all individual scores to calculate the total Wells' score.\n    args:\n        - score_clinical_signs_dvt (float): Score based on clinical signs and symptoms of DVT\n        - score_pe_top_diagnosis (float): Score based on whether pulmonary embolism is the top diagnosis or equally likely\n        - score_heart_rate_gt_100 (float): Score based on heart rate greater than 100 beats per minute\n        - score_immobilization_or_surgery (float): Score based on immobilization or recent surgery\n        - score_previous_pe_or_dvt (float): Score based on previous objectively diagnosed PE or DVT\n        - score_hemoptysis (float): Score based on hemoptysis\n        - score_malignancy_with_treatment_or_palliative (float): Score based on malignancy with treatment or palliative care\n    returns: total_score_wells_criteria (float): Total score calculated using the Wells' criteria for Pulmonary Embolism\n    category: StatisticalAggregation\n    '''\n    total_score = (\n        score_clinical_signs_dvt +\n        score_pe_top_diagnosis +\n        score_heart_rate_gt_100 +\n        score_immobilization_or_surgery +\n        score_previous_pe_or_dvt +\n        score_hemoptysis +\n        score_malignancy_with_treatment_or_palliative\n    )\n    return {'total_score_wells_criteria': total_score}"
            }
        ],
        "output": {
            "output_name": "total_score_wells_criteria",
            "output_desc": "Total score calculated using the Wells' criteria for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells_criteria"
        }
    }
}
2026-02-20 20:23:31 - INFO - analyze_result:
{
    "steps_result_dict": "[\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapClinicalSignsAndSymptomsOfDVT\",\n        \"Description\": \"将临床症状和体征是否为深静脉血栓（DVT）映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"clinical_signs_dvt\",\n                \"input_desc\": \"患者是否有临床症状和体征提示深静脉血栓（DVT）\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_clinical_signs_dvt\",\n                \"output_desc\": \"根据是否出现DVT相关症状的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+3分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPEIsTopDiagnosisOrEquallyLikely\",\n        \"Description\": \"将肺栓塞是否是主要诊断或与之同等可能映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"pe_top_diagnosis\",\n                \"input_desc\": \"肺栓塞是否是主要诊断或与之同等可能\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_pe_top_diagnosis\",\n                \"output_desc\": \"根据是否为肺栓塞主要诊断的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+3分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHeartRateGreaterThan100\",\n        \"Description\": \"将心率是否超过100次/分钟映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"heart_rate_over_100\",\n                \"input_desc\": \"患者的心率是否超过100次/分钟\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_heart_rate\",\n                \"output_desc\": \"根据心率是否超过100次/分钟的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapImmobilizationOrRecentSurgery\",\n        \"Description\": \"将是否长期卧床或近期手术映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"immobilization_or_surgery\",\n                \"input_desc\": \"患者是否长期卧床或近期手术\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_immobilization_surgery\",\n                \"output_desc\": \"根据是否长期卧床或近期手术的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapPreviousPESymptomsOrDVT\",\n        \"Description\": \"将是否有既往肺栓塞或深静脉血栓病史映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"previous_pe_dvt\",\n                \"input_desc\": \"患者是否有既往肺栓塞或深静脉血栓病史\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_previous_pe_dvt\",\n                \"output_desc\": \"根据是否有既往肺栓塞或深静脉血栓病史的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1.5分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapHemoptysis\",\n        \"Description\": \"将是否有咯血映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"hemoptysis\",\n                \"input_desc\": \"患者是否有咯血\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_hemoptysis\",\n                \"output_desc\": \"根据是否有咯血的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"DiscreteValueMapping\",\n        \"Name\": \"MapMalignancyWithTreatmentOrPalliative\",\n        \"Description\": \"将是否有恶性肿瘤且治疗时间在6个月内或姑息治疗映射为对应的分数。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"malignancy_treatment_palliative\",\n                \"input_desc\": \"患者是否有恶性肿瘤且治疗时间在6个月内或接受姑息治疗\",\n                \"input_type\": \"string\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"score_malignancy\",\n                \"output_desc\": \"根据是否有恶性肿瘤且治疗时间在6个月内或接受姑息治疗的得分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"如果输入为'Yes'，则返回+1分；如果输入为'No'，则返回0分。\",\n        \"Reasoning\": \"该步骤涉及将离散值（Yes/No）映射为对应的分数，符合DiscreteValueMapping工具模板。\"\n    },\n    {\n        \"Category\": \"StatisticalAggregation\",\n        \"Name\": \"CalculateTotalScore\",\n        \"Description\": \"将所有指标的得分相加，计算出总分。\",\n        \"Inputs\": [\n            {\n                \"input_name\": \"score_clinical_signs_dvt\",\n                \"input_desc\": \"根据临床症状和体征的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_pe_top_diagnosis\",\n                \"input_desc\": \"根据肺栓塞是否为主要诊断的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_heart_rate\",\n                \"input_desc\": \"根据心率是否超过100次/分钟的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_immobilization_surgery\",\n                \"input_desc\": \"根据是否长期卧床或近期手术的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_previous_pe_dvt\",\n                \"input_desc\": \"根据是否有既往肺栓塞或深静脉血栓病史的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_hemoptysis\",\n                \"input_desc\": \"根据是否有咯血的得分\",\n                \"input_type\": \"float\"\n            },\n            {\n                \"input_name\": \"score_malignancy\",\n                \"input_desc\": \"根据是否有恶性肿瘤且治疗时间在6个月内或接受姑息治疗的得分\",\n                \"input_type\": \"float\"\n            }\n        ],\n        \"Outputs\": [\n            {\n                \"output_name\": \"total_score_wells\",\n                \"output_desc\": \"Wells评分的总分\",\n                \"output_type\": \"float\"\n            }\n        ],\n        \"Detail\": \"将所有得分相加，得到最终的Wells评分。\",\n        \"Reasoning\": \"该步骤是对多个数值进行求和操作，符合StatisticalAggregation工具模板。\"\n    }\n]",
    "flow_result": "(inputs(clinical_signs_dvt, pe_top_diagnosis, heart_rate_over_100, immobilization_or_surgery, previous_pe_dvt, hemoptysis, malignancy_treatment_palliative) -> step1:MapClinicalSignsAndSymptomsOfDVT(clinical_signs_dvt) -> step2:MapPEIsTopDiagnosisOrEquallyLikely(pe_top_diagnosis) -> step3:MapHeartRateGreaterThan100(heart_rate_over_100) -> step4:MapImmobilizationOrRecentSurgery(immobilization_or_surgery) -> step5:MapPreviousPESymptomsOrDVT(previous_pe_dvt) -> step6:MapHemoptysis(hemoptysis) -> step7:MapMalignancyWithTreatmentOrPalliative(malignancy_treatment_palliative) -> step8:CalculateTotalScore(score_clinical_signs_dvt, score_pe_top_diagnosis, score_heart_rate, score_immobilization_surgery, score_previous_pe_dvt, score_hemoptysis, score_malignancy) -> outputs(total_score_wells))"
}
2026-02-20 20:24:15 - INFO - flow_compose_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether the patient has clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the patient's heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_history",
                "step_description": "Map whether the patient has a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on whether the patient has hemoptysis",
                        "input_type": "float"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "float"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves aggregating multiple numerical inputs through summation, fitting the StatisticalAggregation tool template.",
                "detail": "Sum all the individual scores to obtain the final Wells score."
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
            "output_type": "float"
        }
    }
}
2026-02-20 20:24:51 - INFO - step_dataflow_update_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether the patient has clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the patient's heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_history",
                "step_description": "Map whether the patient has a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0."
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_treatment_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0."
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on whether the patient has hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves aggregating multiple numerical inputs through summation, fitting the StatisticalAggregation tool template.",
                "detail": "Sum all the individual scores to obtain the final Wells score."
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells"
        }
    }
}
2026-02-20 20:25:44 - INFO - step_function_generate_result:
{
    "calculate_flow_dict": {
        "name": "wells_criteria_score_calculation",
        "description": "Calculate the patient's score based on Wells' criteria for Pulmonary Embolism.",
        "inputs": [
            {
                "input_name": "clinical_signs_dvt",
                "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                "input_type": "string"
            },
            {
                "input_name": "pe_top_diagnosis",
                "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                "input_type": "string"
            },
            {
                "input_name": "heart_rate_over_100",
                "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                "input_type": "string"
            },
            {
                "input_name": "immobilization_or_surgery",
                "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                "input_type": "string"
            },
            {
                "input_name": "previous_pe_dvt",
                "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                "input_type": "string"
            },
            {
                "input_name": "hemoptysis",
                "input_desc": "Whether the patient has hemoptysis",
                "input_type": "string"
            },
            {
                "input_name": "malignancy_treatment_palliative",
                "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                "input_type": "string"
            }
        ],
        "steps": [
            {
                "step_id": "1",
                "step_name": "map_clinical_signs_and_symptoms_of_dvt",
                "step_description": "Map whether the patient has clinical signs and symptoms of DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "clinical_signs_dvt",
                        "input_desc": "Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)",
                        "input_type": "string",
                        "input_source": "$|inputs|.clinical_signs_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_clinical_signs_dvt",
                        "output_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0.",
                "code": "def map_clinical_signs_and_symptoms_of_dvt(clinical_signs_dvt: str) -> float:\n    '''\n    decs:map whether the patient has clinical signs and symptoms of DVT to the corresponding score\n    args:\n        - clinical_signs_dvt (str): Whether the patient has clinical signs and symptoms of deep vein thrombosis (DVT)\n    returns: score_clinical_signs_dvt: Score based on whether the patient has clinical signs and symptoms of DVT\n    category: DiscreteValueMapping\n    '''\n    if clinical_signs_dvt == 'Yes':\n        return 3.0\n    elif clinical_signs_dvt == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be 'Yes' or 'No'\")"
            },
            {
                "step_id": "2",
                "step_name": "map_pe_is_top_diagnosis_or_equally_likely",
                "step_description": "Map whether pulmonary embolism is the top diagnosis or equally likely to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "pe_top_diagnosis",
                        "input_desc": "Whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "string",
                        "input_source": "$|inputs|.pe_top_diagnosis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_pe_top_diagnosis",
                        "output_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +3.0; if the input is 'No', return 0.0.",
                "code": "def map_pe_is_top_diagnosis_or_equally_likely(pe_top_diagnosis: str) -> float:\n    '''\n    decs:map whether pulmonary embolism is the top diagnosis or equally likely to the corresponding score\n    args:\n        - pe_top_diagnosis (str): Whether pulmonary embolism is the top diagnosis or equally likely\n    returns: score_pe_top_diagnosis: Score based on whether pulmonary embolism is the top diagnosis or equally likely\n    category: DiscreteValueMapping\n    '''\n    if pe_top_diagnosis == 'Yes':\n        return 3.0\n    elif pe_top_diagnosis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "3",
                "step_name": "map_heart_rate_greater_than_100",
                "step_description": "Map whether the patient's heart rate is greater than 100 beats per minute to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "heart_rate_over_100",
                        "input_desc": "Whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "string",
                        "input_source": "$|inputs|.heart_rate_over_100"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_heart_rate",
                        "output_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0.",
                "code": "def map_heart_rate_greater_than_100(heart_rate_over_100: str) -> dict:\n    '''\n    decs: Map whether the patient's heart rate is greater than 100 beats per minute to the corresponding score.\n    args:\n        - heart_rate_over_100 (str): Whether the patient's heart rate is greater than 100 beats per minute ('Yes' or 'No')\n    returns: score_heart_rate (float): Score based on whether the patient's heart rate is greater than 100 beats per minute\n    category: DiscreteValueMapping\n    '''\n    if heart_rate_over_100 == 'Yes':\n        score = 1.5\n    else:\n        score = 0.0\n\n    return {'score_heart_rate': score}"
            },
            {
                "step_id": "4",
                "step_name": "map_immobilization_or_recent_surgery",
                "step_description": "Map whether the patient has immobilization for at least 3 days or recent surgery to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "immobilization_or_surgery",
                        "input_desc": "Whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks",
                        "input_type": "string",
                        "input_source": "$|inputs|.immobilization_or_surgery"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_immobilization_surgery",
                        "output_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0.",
                "code": "def map_immobilization_or_recent_surgery(immobilization_or_surgery: str) -> float:\n    '''\n    decs:map whether the patient has immobilization for at least 3 days or recent surgery to the corresponding score\n    args:\n        - immobilization_or_surgery (str): whether the patient has immobilization for at least 3 days or surgery in the previous 4 weeks\n    returns: score_immobilization_surgery (float): score based on whether the patient has immobilization for at least 3 days or recent surgery\n    category: DiscreteValueMapping\n    '''\n    if immobilization_or_surgery == 'Yes':\n        return 1.5\n    elif immobilization_or_surgery == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")"
            },
            {
                "step_id": "5",
                "step_name": "map_previous_pe_or_dvt_history",
                "step_description": "Map whether the patient has a history of objectively diagnosed PE or DVT to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "previous_pe_dvt",
                        "input_desc": "Whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "string",
                        "input_source": "$|inputs|.previous_pe_dvt"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_previous_pe_dvt",
                        "output_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.5; if the input is 'No', return 0.0.",
                "code": "def map_previous_pe_dvt_history(previous_pe_dvt: str) -> dict:\n    '''\n    decs: Map whether the patient has a history of objectively diagnosed PE or DVT to the corresponding score.\n    args:\n        - previous_pe_dvt (str): Whether the patient has a history of objectively diagnosed PE or DVT ('Yes' or 'No').\n    returns: \n        - score_previous_pe_dvt (float): Score based on whether the patient has a history of objectively diagnosed PE or DVT.\n    category: DiscreteValueMapping\n    '''\n    if previous_pe_dvt == 'Yes':\n        score = 1.5\n    elif previous_pe_dvt == 'No':\n        score = 0.0\n    else:\n        raise ValueError(\"Invalid input. Expected 'Yes' or 'No'.\")\n    \n    return {'score_previous_pe_dvt': score}"
            },
            {
                "step_id": "6",
                "step_name": "map_hemoptysis",
                "step_description": "Map whether the patient has hemoptysis to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "hemoptysis",
                        "input_desc": "Whether the patient has hemoptysis",
                        "input_type": "string",
                        "input_source": "$|inputs|.hemoptysis"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_hemoptysis",
                        "output_desc": "Score based on whether the patient has hemoptysis",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0.",
                "code": "def map_hemoptysis(hemoptysis: str) -> float:\n    '''\n    decs:map whether the patient has hemoptysis to the corresponding score\n    args:\n        - hemoptysis (str): Whether the patient has hemoptysis, possible values are 'Yes' or 'No'\n    returns: score_hemoptysis: Score based on whether the patient has hemoptysis\n    category: DiscreteValueMapping\n    '''\n    if hemoptysis == 'Yes':\n        return 1.0\n    elif hemoptysis == 'No':\n        return 0.0\n    else:\n        raise ValueError(\"Invalid input value for hemoptysis. Expected 'Yes' or 'No'.\")"
            },
            {
                "step_id": "7",
                "step_name": "map_malignancy_with_treatment_or_palliative",
                "step_description": "Map whether the patient has malignancy with treatment within 6 months or palliative care to the corresponding score.",
                "step_inputs": [
                    {
                        "input_name": "malignancy_treatment_palliative",
                        "input_desc": "Whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "string",
                        "input_source": "$|inputs|.malignancy_treatment_palliative"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "score_malignancy",
                        "output_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "output_type": "float"
                    }
                ],
                "category": "DiscreteValueMapping",
                "reason": "This step involves mapping discrete values (Yes/No) to corresponding scores, fitting the DiscreteValueMapping tool template.",
                "detail": "If the input is 'Yes', return +1.0; if the input is 'No', return 0.0.",
                "code": "def map_malignancy_with_treatment_or_palliative(malignancy_treatment_palliative: str) -> dict:\n    '''\n    decs: Map whether the patient has malignancy with treatment within 6 months or palliative care to the corresponding score.\n    args:\n        - malignancy_treatment_palliative (str): Whether the patient has malignancy with treatment within 6 months or palliative care\n    returns: score_malignancy: Score based on whether the patient has malignancy with treatment within 6 months or palliative care\n    category: DiscreteValueMapping\n    '''\n    if malignancy_treatment_palliative == 'Yes':\n        score = 1.0\n    elif malignancy_treatment_palliative == 'No':\n        score = 0.0\n    else:\n        raise ValueError(\"Input must be either 'Yes' or 'No'\")\n    \n    return {'score_malignancy': score}"
            },
            {
                "step_id": "8",
                "step_name": "calculate_total_wells_score",
                "step_description": "Sum all individual scores to calculate the total Wells score.",
                "step_inputs": [
                    {
                        "input_name": "score_clinical_signs_dvt",
                        "input_desc": "Score based on whether the patient has clinical signs and symptoms of DVT",
                        "input_type": "float",
                        "input_source": "$|1|.score_clinical_signs_dvt"
                    },
                    {
                        "input_name": "score_pe_top_diagnosis",
                        "input_desc": "Score based on whether pulmonary embolism is the top diagnosis or equally likely",
                        "input_type": "float",
                        "input_source": "$|2|.score_pe_top_diagnosis"
                    },
                    {
                        "input_name": "score_heart_rate",
                        "input_desc": "Score based on whether the patient's heart rate is greater than 100 beats per minute",
                        "input_type": "float",
                        "input_source": "$|3|.score_heart_rate"
                    },
                    {
                        "input_name": "score_immobilization_surgery",
                        "input_desc": "Score based on whether the patient has immobilization for at least 3 days or recent surgery",
                        "input_type": "float",
                        "input_source": "$|4|.score_immobilization_surgery"
                    },
                    {
                        "input_name": "score_previous_pe_dvt",
                        "input_desc": "Score based on whether the patient has a history of objectively diagnosed PE or DVT",
                        "input_type": "float",
                        "input_source": "$|5|.score_previous_pe_dvt"
                    },
                    {
                        "input_name": "score_hemoptysis",
                        "input_desc": "Score based on whether the patient has hemoptysis",
                        "input_type": "float",
                        "input_source": "$|6|.score_hemoptysis"
                    },
                    {
                        "input_name": "score_malignancy",
                        "input_desc": "Score based on whether the patient has malignancy with treatment within 6 months or palliative care",
                        "input_type": "float",
                        "input_source": "$|7|.score_malignancy"
                    }
                ],
                "step_outputs": [
                    {
                        "output_name": "total_score_wells",
                        "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
                        "output_type": "float"
                    }
                ],
                "category": "StatisticalAggregation",
                "reason": "This step involves aggregating multiple numerical inputs through summation, fitting the StatisticalAggregation tool template.",
                "detail": "Sum all the individual scores to obtain the final Wells score.",
                "code": "def calculate_total_wells_score(score_clinical_signs_dvt: float, score_pe_top_diagnosis: float, score_heart_rate: float, score_immobilization_surgery: float, score_previous_pe_dvt: float, score_hemoptysis: float, score_malignancy: float) -> float:\n    '''\n    decs: calculate the total wells score by summing all individual scores\n    args:\n        - score_clinical_signs_dvt (float): Score based on whether the patient has clinical signs and symptoms of DVT\n        - score_pe_top_diagnosis (float): Score based on whether pulmonary embolism is the top diagnosis or equally likely\n        - score_heart_rate (float): Score based on whether the patient's heart rate is greater than 100 beats per minute\n        - score_immobilization_surgery (float): Score based on whether the patient has immobilization for at least 3 days or recent surgery\n        - score_previous_pe_dvt (float): Score based on whether the patient has a history of objectively diagnosed PE or DVT\n        - score_hemoptysis (float): Score based on whether the patient has hemoptysis\n        - score_malignancy (float): Score based on whether the patient has malignancy with treatment within 6 months or palliative care\n    returns: total_score_wells (float): Total score based on Wells' criteria for Pulmonary Embolism\n    category: StatisticalAggregation\n    '''\n    total_score_wells = (\n        score_clinical_signs_dvt +\n        score_pe_top_diagnosis +\n        score_heart_rate +\n        score_immobilization_surgery +\n        score_previous_pe_dvt +\n        score_hemoptysis +\n        score_malignancy\n    )\n    return total_score_wells"
            }
        ],
        "output": {
            "output_name": "total_score_wells",
            "output_desc": "Total score based on Wells' criteria for Pulmonary Embolism",
            "output_type": "float",
            "output_source": "$|8|.total_score_wells"
        }
    }
}
